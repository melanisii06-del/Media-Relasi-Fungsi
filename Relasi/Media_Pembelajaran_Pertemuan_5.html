<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>THE LOGIC LAB â€” Interactive Function Investigation</title>
<link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{
  --bg:#ffcb64;
  --panel:#fff3d9;
  --accent:#3e2723;
  --muted:#6b4b3a;
  --success:#2e7d32;
  --danger:#c62828;
  --info:#0284c7;
  --warning:#f59e0b;
}

html,body{
  height:100%;
  margin:0;
  font-family:'Bagel Fat One',cursive;
  background:var(--bg);
  color:var(--accent);
}

body {
  background: linear-gradient(135deg, #ffcb64 0%, #ffc850 50%, #ffb84d 100%);
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.08), transparent 50%);
  z-index: -1;
  pointer-events: none;
}

.wrapper{
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:28px;
  box-sizing:border-box;
}

.card{
  width:1100px;
  max-width:98%;
  background:linear-gradient(180deg,var(--panel),#fff7e6);
  border-radius:18px;
  box-shadow:0 18px 40px rgba(0,0,0,.12);
  overflow:visible;
  position:relative;
}

.header{text-align:center;padding-top:10px}
h1{font-size:44px;margin:6px 0;color:var(--accent)}
h2{font-size:28px;color:var(--accent);margin:12px 0}
h3{font-size:20px;color:var(--accent);margin:10px 0}

.lead{color:rgba(0,0,0,0.6);margin-bottom:18px}
.slides{min-height:60vh;padding:28px 18px;}
.slide{display:none;padding:10px 18px 20px 18px;min-height:400px}
.slide.active{display:block;animation: fadeIn 0.5s ease-out;}
.center{display:flex;flex-direction:column;align-items:center;gap:12px;padding-top:100px}

.btn{
  background:var(--accent);
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:12px;
  cursor:pointer;
  font-size:16px;
  transition: all 0.3s ease;
  font-family:'Bagel Fat One',cursive;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}
.btn.ghost{background:transparent;color:var(--accent);border:2px solid var(--accent)}
.btn:disabled{opacity:0.5;cursor:not-allowed}

.card-lite{
  background:#fffdf6;
  border:2px dashed #ffd199;
  border-radius:14px;
  padding:14px;
  margin:10px 0;
  animation: fadeIn 0.6s ease-out;
}

.scenario-box{
  background:#fff;
  border-left:4px solid var(--info);
  padding:16px;
  margin:12px 0;
  border-radius:8px;
}

.scratchpad{
  background:#f9fafb;
  border:2px solid #e5e7eb;
  border-radius:8px;
  padding:16px;
  margin:12px 0;
}

.scratchpad-row{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:12px;
  flex-wrap:wrap;
}

.scratchpad-row input{
  padding:8px 12px;
  border:2px solid #d1d5db;
  border-radius:6px;
  font-family:Arial,sans-serif;
  font-size:14px;
}

.scratchpad-row input:focus{
  outline:none;
  border-color:var(--info);
  box-shadow:0 0 0 3px rgba(2,132,199,0.1);
}

.formula-display{
  background:#f3f4f6;
  padding:12px;
  border-radius:6px;
  margin:8px 0;
  text-align:center;
  font-weight:700;
  font-family:monospace;
  font-size:16px;
  color:var(--accent);
}

.drag-zone{
  background:#fef3c7;
  border:2px dashed #f59e0b;
  border-radius:8px;
  padding:16px;
  min-height:80px;
  margin:12px 0;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:flex-start;
  justify-content:flex-start;
}

.drag-item{
  background:#fff;
  border:2px solid #f59e0b;
  padding:8px 12px;
  border-radius:6px;
  cursor:grab;
  user-select:none;
  transition:all 0.3s ease;
  font-weight:600;
}

.drag-item:hover{
  transform:scale(1.05);
  box-shadow:0 4px 8px rgba(245,158,11,0.3);
}

.drag-item.dragging{
  opacity:0.7;
  cursor:grabbing;
}

.target-zone{
  background:#f0f9ff;
  border:2px dashed var(--info);
  border-radius:8px;
  padding:12px;
  min-height:60px;
  margin:8px 0;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:flex-start;
}

.target-zone h4{
  width:100%;
  margin:0 0 8px 0;
  font-size:14px;
  color:var(--muted);
}

.feedback-box{
  padding:12px;
  border-radius:8px;
  margin:12px 0;
  display:none;
  font-weight:600;
}

.feedback-box.success{
  display:block;
  background:#d1fae5;
  border-left:4px solid var(--success);
  color:#065f46;
}

.feedback-box.error{
  display:block;
  background:#fee2e2;
  border-left:4px solid var(--danger);
  color:#7f1d1d;
}

.feedback-box.warning{
  display:block;
  background:#fef3c7;
  border-left:4px solid var(--warning);
  color:#78350f;
}

/* Styling untuk pilihan penyajian */
.penyajian-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  background: #fff;
  border: 2px solid #ddd;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.penyajian-option:hover {
  background: #fffbf0;
  border-color: var(--accent);
  transform: translateY(-2px);
}

.penyajian-option input[type="radio"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.penyajian-option input[type="radio"]:checked + span {
  font-weight: 700;
  color: var(--accent);
}

.penyajian-option span {
  font-size: 16px;
  color: var(--muted);
  transition: all 0.2s ease;
}

/* Styling untuk komentar */
.komentar-item {
  background: #f9f9f9;
  border-left: 4px solid var(--accent);
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  animation: slideInLeft 0.5s ease-out;
}

.komentar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.komentar-kelompok {
  font-weight: 700;
  color: var(--accent);
  font-size: 14px;
}

.komentar-waktu {
  font-size: 12px;
  color: #999;
}

.komentar-isi {
  color: #333;
  line-height: 1.5;
  font-family: Arial, sans-serif;
  font-size: 14px;
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.data-table{
  width:100%;
  border-collapse:collapse;
  margin:12px 0;
  background:#fff;
}

.data-table th{
  background:#fff3d9;
  border:1px solid #ffd199;
  padding:10px;
  text-align:left;
  font-weight:700;
  color:var(--accent);
}

.data-table td{
  border:1px solid #ffd199;
  padding:10px;
}

.data-table input{
  width:90%;
  padding:6px 8px;
  border:1px solid #d1d5db;
  border-radius:4px;
  font-family:Arial,sans-serif;
}

.status-icon{
  font-size:18px;
  font-weight:700;
}

.calculation-steps{
  background:#f3f4f6;
  padding:12px;
  border-radius:8px;
  margin:8px 0;
  font-family:monospace;
  font-size:13px;
  color:#374151;
  line-height:1.6;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width:920px){ 
  .card{padding:12px} 
  h1{font-size:32px} 
  .scratchpad-row{flex-direction:column}
}

/* Modal overlay untuk Google Form */
#gformModal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
  animation: fadeInModal 0.3s ease;
}

#gformModalContent {
  position: relative;
  background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
  margin: 5% auto;
  padding: 40px;
  border-radius: 20px;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  animation: slideDownModal 0.4s ease;
  text-align: center;
}

#gformModalClose {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 32px;
  font-weight: bold;
  color: #999;
  cursor: pointer;
  transition: color 0.2s;
}

#gformModalClose:hover {
  color: #333;
}

.gform-title {
  color: #2a2420;
  font-size: 24px;
  margin-bottom: 20px;
  font-weight: 700;
}

.gform-message {
  color: #555;
  font-size: 16px;
  line-height: 1.6;
  margin-bottom: 30px;
}

.gform-link-btn {
  display: inline-block;
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  color: white;
  padding: 18px 40px;
  font-size: 20px;
  font-weight: 700;
  border-radius: 12px;
  text-decoration: none;
  box-shadow: 0 4px 15px rgba(76,175,80,0.4);
  transition: all 0.3s ease;
  margin: 10px;
}

.gform-link-btn:hover {
  background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
  box-shadow: 0 6px 20px rgba(76,175,80,0.5);
  transform: translateY(-2px);
}

.gform-close-btn {
  display: inline-block;
  background: #ccc;
  color: #333;
  padding: 12px 30px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 20px;
  transition: all 0.2s;
}

.gform-close-btn:hover {
  background: #bbb;
}

@keyframes fadeInModal {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideDownModal {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes floating {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-12px); }
}

h1, h2 {
  animation: floating 3s ease-in-out infinite;
}
</style>
</head>
<body>

<!-- Modal Google Form -->
<div id="gformModal">
  <div id="gformModalContent">
    <span id="gformModalClose" onclick="closeGFormModal()">&times;</span>
    <div class="gform-title">âœ… PDF Berhasil Didownload!</div>
    <div class="gform-message">
      <p style="margin:10px 0;">File PDF hasil pembelajaran sudah tersimpan di komputer Anda.</p>
      <p style="margin:10px 0;font-weight:700;color:#d32f2f;">Sekarang silakan upload ke Google Form:</p>
    </div>
    <a href="" id="gformLink" class="gform-link-btn" target="_blank">ğŸ“ BUKA GOOGLE FORM</a>
    <div style="margin-top:25px;padding:20px;background:#fff9e6;border-radius:10px;text-align:left;">
      <p style="font-size:14px;margin:8px 0;color:#333;"><strong>Instruksi:</strong></p>
      <ol style="font-size:13px;line-height:1.8;color:#555;margin:8px 0;padding-left:20px;">
        <li>Klik tombol hijau di atas untuk membuka Google Form</li>
        <li>Isi nama kelompok Anda</li>
        <li>Upload file PDF yang baru didownload</li>
        <li>Klik Submit</li>
      </ol>
      <p style="font-size:12px;margin:10px 0;color:#777;font-style:italic;">ğŸ’¡ File akan otomatis masuk ke Google Drive guru!</p>
    </div>
    <div class="gform-close-btn" onclick="closeGFormModal()">Tutup</div>
  </div>
</div>

<div class="wrapper">
  <div class="card">
    <div class="header">
      <h1>Media Pembelajaran</h1>

    </div>

    <main class="slides">
      <!-- Slide 1: Start -->
      <section class="slide active" id="start">
        <div class="center">
          <h2>Selamat Datang di Media Pembelajaran</h2>
          <p class="lead">Investigasi Mandiri: Dari Masalah Nyata ke Pemahaman Fungsi</p>
          <p style="color:var(--muted);max-width:600px;text-align:center">
            Dalam lab ini, Anda akan menganalisis masalah nyata, menemukan pola, dan memvalidasi rumus dengan sistem feedback real-time.
          </p>
          <button class="btn" onclick="show('permasalahan-foto')">Mulai Pembelajaran âŸ¶</button>
        </div>
      </section>

      <!-- Slide Baru: Latihan Menghitung Jarak Lainnya -->
      <section class="slide" id="latihan-hitung-jarak">
        <div class="card-lite">
          <h2>ğŸ“Š Latihan: Hitung Tarif untuk Berbagai Jarak</h2>
          <p style="color:var(--muted);margin-bottom:16px">Sekarang giliran kalian! Gunakan rumus yang sudah kalian pahami untuk menghitung tarif perjalanan ojek online untuk jarak-jarak berikut. Isi tabel di bawah ini dengan perhitungan kalian.</p>

          <div style="margin:20px 0">
            <h3 style="color:var(--accent);margin-bottom:12px">ğŸ“ Tabel Perhitungan Siswa</h3>
            <table class="data-table">
              <thead>
                <tr>
                  <th>Jarak (km)</th>
                  <th>Perhitungan (tulis di sini)</th>
                  <th>Tarif (Rp)</th>
                  <th>Validasi</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="text-align:center"><strong>2</strong></td>
                  <td><input type="text" id="calc2" placeholder="Contoh: 4.000 Ã— 2 + 5.000" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif2" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status2">â€”</span></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>5</strong></td>
                  <td><input type="text" id="calc5" placeholder="Tulis perhitunganmu" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif5" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status5">â€”</span></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>7</strong></td>
                  <td><input type="text" id="calc7" placeholder="Tulis perhitunganmu" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif7" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status7">â€”</span></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>10</strong></td>
                  <td><input type="text" id="calc10" placeholder="Tulis perhitunganmu" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif10" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status10">â€”</span></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>12</strong></td>
                  <td><input type="text" id="calc12" placeholder="Tulis perhitunganmu" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif12" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status12">â€”</span></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>15</strong></td>
                  <td><input type="text" id="calc15" placeholder="Tulis perhitunganmu" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif15" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status15">â€”</span></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>20</strong></td>
                  <td><input type="text" id="calc20" placeholder="Tulis perhitunganmu" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td><input type="number" id="tarif20" placeholder="0" style="width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px"></td>
                  <td style="text-align:center"><span id="status20">â€”</span></td>
                </tr>
              </tbody>
            </table>

            <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap">
              <button class="btn" id="btnCekJawaban" style="flex:1;min-width:200px">âœ“ Cek Semua Jawaban</button>
              <button class="btn ghost" id="btnResetTabel">ğŸ”„ Reset Tabel</button>
            </div>

            <div id="feedbackLatihan" class="feedback-box" style="margin-top:16px"></div>
          </div>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:20px;flex-wrap:wrap">
            <button class="btn ghost" onclick="show('skenario')">âŸµ Kembali</button>
            <button class="btn" id="btnLanjutKeScratchpadDariLatihan" onclick="show('scratchpad')">Lanjut Validasi Rumus âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide 2: Permasalahan Foto (Parkir Nadia) -->
      <section class="slide" id="permasalahan-foto">
        <div class="card-lite">
          <h2>ğŸ“¸ Fase 1: Orientasi Permasalahan</h2>
          <h3 style="text-align:center;margin:16px 0">Permasalahan â€” Menentukan Tarif Ojek Online</h3>
          <p style="color:var(--muted);text-align:center;margin-bottom:20px">Baca konteks singkat berikut, identifikasi yang diketahui dan ditanyakan, lalu bantu menyajikan tarif dalam diagram panah dan rumus fungsi.</p>

          <div style="text-align:center;margin:20px 0">
            <img src="../images/gojek.png" alt="Ilustrasi tarif parkir" style="max-width:100%;height:auto;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.1)">
          </div>

          <!-- Cerita Permasalahan Ojek + Diketahui + Ditanyakan dipindah ke bawah foto -->
          <div class="scenario-box" style="max-width:800px;margin:20px auto">
            <h4 style="color:var(--accent);margin:0 0 12px 0">ğŸï¸ Cerita Permasalahan</h4>
            <p style="margin:0 0 12px 0;color:var(--muted);font-size:15px;line-height:1.8">
              Pak Budi adalah seorang driver ojek online yang bekerja di aplikasi <strong>"GoRide Express"</strong>. Setiap hari, banyak penumpang yang bertanya tentang tarif perjalanan mereka sebelum memesan. Pak Budi ingin membuat diagram panah atau tabel yang jelas agar penumpang dapat langsung mengetahui tarif berdasarkan jarak yang ditempuh.
            </p>

            <div style="background:#fff3cd;border-left:4px solid #ffc107;padding:12px;border-radius:6px;margin:12px 0">
              <p style="margin:0 0 8px 0;color:var(--accent);font-weight:700">ğŸ“Œ Yang Diketahui:</p>
              <ul style="margin:0;padding-left:20px;color:var(--muted);line-height:1.8">
                <li><strong>Tarif 1 km pertama:</strong> Rp5.000 (tarif dasar/minimum)</li>
                <li><strong>Tarif km tambahan:</strong> Rp4.000 per km (mulai dari km ke-2 dan seterusnya)</li>
              </ul>
            </div>

            <div style="background:#e0f2fe;border-left:4px solid var(--info);padding:12px;border-radius:6px;margin:12px 0">
              <p style="margin:0 0 8px 0;color:var(--accent);font-weight:700">â“ Ditanyakan:</p>
              <p style="margin:0;color:var(--muted);line-height:1.8">
                Seorang penumpang ingin pergi ke tempat yang berjarak <strong>9 km</strong> dari lokasi penjemputan. Berapakah tarif yang harus dibayar oleh penumpang tersebut?
              </p>
            </div>
          </div>

          <!-- Textarea untuk siswa menuliskan solusi -->
          <div style="max-width:800px;margin:24px auto">
            <label style="display:block;color:var(--accent);font-weight:700;font-size:16px;margin-bottom:10px">ğŸ’¡ Ide Solusi Awal Kalian:</label>
            <p style="color:var(--muted);font-size:14px;margin-bottom:10px">Sebelum melanjutkan, tuliskan ide awal kalian tentang bagaimana cara menyelesaikan permasalahan ini:</p>
            <textarea id="solusiAwalPertemuan4" placeholder="Contoh: Saya akan membuat diagram/tabel yang menghubungkan jarak dengan tarif, atau membuat rumus untuk menghitung tarif berdasarkan jarak..." style="width:100%;min-height:120px;padding:14px;border-radius:10px;border:2px solid rgba(0,0,0,0.1);background:#fff;font-family:sans-serif;font-size:14px;resize:vertical;box-sizing:border-box"></textarea>
            <p style="color:var(--muted);font-size:12px;margin-top:8px;font-style:italic">ğŸ’­ Tidak apa jika belum yakin, tuliskan saja apa yang terpikirkan saat ini!</p>
          </div>

          

          <p style="text-align:center;color:var(--muted);margin:20px 0;font-size:15px">
            âš ï¸ Sebelum memulai, silakan duduk bersama kelompok Anda â€” permasalahan ini dikerjakan secara berkelompok!
          </p>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:30px">
            <button class="btn ghost" onclick="show('start')">âŸµ Kembali</button>
            <button class="btn" onclick="show('identitas-kelompok')">Lanjut ke Identitas Kelompok âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide 3: Identitas Kelompok -->
      <section class="slide" id="identitas-kelompok">
        <div class="card-lite">
          <h2>ğŸ‘¥ Fase 2: Mengorganisasi Siswa untuk Belajar</h2>
          <p style="color:var(--muted);margin-bottom:20px">Silakan isi data kelompok Anda sebelum melanjutkan ke tahap penyelidikan.</p>

          <div class="scenario-box" style="max-width:700px;margin:20px auto">
            <label for="namaKelompok" style="display:block;margin-bottom:8px;color:var(--accent);font-weight:700;font-size:16px">ğŸ“ Nama Kelompok</label>
            <input type="text" id="namaKelompok" placeholder="Contoh: Kelompok Hemat Cerdas" style="width:100%;padding:12px;border-radius:8px;border:2px solid #d1d5db;font-family:'Bagel Fat One',cursive;font-size:15px;box-sizing:border-box">
          </div>

          <!-- PREVIEW ANGGOTA YANG SUDAH DI-INPUT -->
          <div class="scenario-box" style="max-width:700px;margin:20px auto;background:#f9f5ff;border-left:4px solid #c084fc">
            <label style="color:var(--accent);font-weight:700;font-size:16px;display:block;margin-bottom:12px">âœ… Anggota yang Sudah Terdaftar</label>
            <div id="previewAnggota" style="display:flex;flex-direction:column;gap:12px;min-height:40px">
              <div style="color:var(--muted);font-size:14px;text-align:center;padding:20px">
                ğŸ“ Belum ada anggota yang di-input. Isi form di bawah untuk mulai.
              </div>
            </div>
          </div>

          <!-- FORM INPUT ANGGOTA -->
          <div class="scenario-box" style="max-width:700px;margin:20px auto">
            <label style="color:var(--accent);font-weight:700;font-size:16px;display:block;margin-bottom:12px">ğŸ‘¤ Input Anggota &amp; Tugas Kelompok</label>
            <div style="font-size:13px;color:var(--muted);margin-bottom:16px;padding:10px;background:#fff3cd;border-radius:6px;border-left:3px solid #ffcb64">
              <b>ğŸ’¡ Petunjuk:</b> Isi nama dan pilih peran untuk setiap anggota, kemudian klik <b>"INPUT"</b>. Tugas lengkap akan terlihat setelah Anda mengklik tombol tersebut.
            </div>

            <div style="display:flex;gap:8px;margin-bottom:12px">
              <div style="flex:1">
                <label style="display:block;font-size:12px;color:var(--accent);font-weight:700;margin-bottom:4px">Nama Anggota</label>
                <input type="text" id="inputNamaAnggota" placeholder="Ketik nama anggota..." style="width:100%;padding:10px;border-radius:6px;border:2px solid #d1d5db;font-family:'Bagel Fat One',cursive;font-size:14px;box-sizing:border-box">
              </div>
              <div style="flex:1">
                <label style="display:block;font-size:12px;color:var(--accent);font-weight:700;margin-bottom:4px">Pilih Peran</label>
                <select id="selectPenanggungJawab" style="width:100%;padding:10px;border-radius:6px;border:2px solid #d1d5db;font-family:'Bagel Fat One',cursive;font-size:14px;box-sizing:border-box">
                  <option value="">-- Pilih peran --</option>
                  <option value="Ketua Kelompok">Ketua Kelompok</option>
                  <option value="Wakil Ketua">Wakil Ketua</option>
                  <option value="Sekretaris">Sekretaris</option>
                  <option value="Anggota Aktif">Anggota Aktif</option>
                  <option value="Anggota">Anggota</option>
                </select>
              </div>
              <div>
                <label style="display:block;font-size:12px;color:var(--accent);font-weight:700;margin-bottom:4px">&nbsp;</label>
                <button class="btn" id="btnInputAnggota" style="padding:10px 20px;font-size:14px;width:100%">INPUT âœ</button>
              </div>
            </div>

            <!-- Deskripsi peran (muncul ketika dipilih) -->
            <div id="deskripsiPeran" style="display:none;padding:12px;background:#f0f9ff;border-radius:6px;border-left:4px solid #3b82f6;margin-bottom:12px;font-size:13px;color:#1e40af">
              <b style="display:block;margin-bottom:6px">ğŸ“‹ Tugas untuk peran ini:</b>
              <span id="deskripsiTeks"></span>
            </div>
          </div>

          <div id="feedbackKelompok" style="margin:20px auto;max-width:700px;padding:12px;border-radius:8px;text-align:center;display:none"></div>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:30px">
            <button class="btn ghost" onclick="show('permasalahan-foto')">âŸµ Kembali</button>
            <button class="btn" onclick="show('skenario')">Lanjut ke Penyelidikan âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide 4: FASE 3 - Membimbing Penyelidikan -->
      <section class="slide" id="skenario">
        <div class="card-lite">
          <h2>ğŸ”¬ Fase 3: Membimbing Penyelidikan - Investigasi Pola Tarif</h2>
          
          <!-- PENGANTAR AKTIVITAS INVESTIGASI -->
          <div style="margin-bottom:16px;padding:12px;border-radius:10px;background:#fff3cd;border-left:4px solid #ffcb64;color:#3e2723">
            <strong style="display:block;margin-bottom:6px">ğŸ“Œ Mengapa Kegiatan Ini Penting?</strong>
            <div class="small">Dalam kehidupan nyata, data sering kali tampak acak dan membingungkan. Tugas kalian adalah seperti seorang data scientist â€” menemukan POLA tersembunyi di balik data. Dengan menemukan pola, kalian dapat membuat RUMUS FUNGSI yang bisa memprediksi tarif untuk jarak berapa saja tanpa harus tanya-tanya ke aplikasi!</div>
          </div>

          <p style="color:var(--muted);margin-bottom:16px">
            <strong>Tugas Kelompok:</strong> Analisis data tarif dari aplikasi GoRide Express, temukan polanya, dan buat rumus untuk menghitung tarif jarak berapa saja!
          </p>

          <!-- Data Real dari Aplikasi -->
          <div class="scenario-box">
            <p style="margin:12px 0;color:var(--accent);font-weight:700">ğŸ“Š Data Real dari Aplikasi GoRide Express:</p>
            <table class="data-table" style="margin:12px 0">
              <thead>
                <tr>
                  <th>Jarak Perjalanan (km)</th>
                  <th>Tarif yang Dikenakan (Rp)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="text-align:center"><strong>2 km</strong></td>
                  <td style="text-align:center"><strong>Rp 13.000</strong></td>
                </tr>
                <tr>
                  <td style="text-align:center"><strong>3 km</strong></td>
                  <td style="text-align:center"><strong>Rp 17.000</strong></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- STEP 1: Observasi Data -->
          <div class="scenario-box" style="border-left-color:#3b82f6;background:#eff6ff;margin-top:16px">
            <p style="margin:0;color:#1e40af;font-weight:700">ğŸ“ STEP 1: Amati Data</p>
            <div style="margin-top:12px;font-size:14px;color:var(--muted);line-height:1.8">
              <p style="font-weight:700;color:#2563eb">Pertanyaan Pembimbing:</p>
              <p>â–¸ Apa yang kamu lihat dari kedua data ini?</p>
              <p>â–¸ Jika jarak bertambah dari 2 km menjadi 3 km (bertambah <strong>1 km</strong>), bagaimana dengan tarifnya?</p>
              
              <label style="display:block;margin-top:12px;margin-bottom:6px;color:#1e40af;font-weight:700">Tuliskan pengamatanmu:</label>
              <textarea id="observasiData" placeholder="Contoh: Saya lihat ketika jarak bertambah 1 km, tarif juga naik dari 13.000 menjadi 17.000..." style="width:100%;padding:10px;border-radius:6px;border:2px solid #93c5fd;font-family:sans-serif;font-size:13px;min-height:70px;background:#fff"></textarea>
            </div>
          </div>

          <!-- STEP 2: Analisis Pola -->
          <div class="scenario-box" style="border-left-color:#f59e0b;background:#fffbf0;margin-top:16px">
            <p style="margin:0;color:#92400e;font-weight:700">ğŸ” STEP 2: Cari Pola Penambahan Tarif</p>
            <div style="margin-top:12px;font-size:14px;color:var(--muted);line-height:1.8">
              <p style="font-weight:700;color:#d97706">Pertanyaan Pembimbing:</p>
              <p>â–¸ Berapa selisih tarif antara 3 km dan 2 km? (Hitung: 17.000 - 13.000 = ?)</p>
              <p>â–¸ Jika pola ini TETAP BERLANJUT, berapa kira-kira tarif untuk <strong>4 km</strong>?</p>
              <p>â–¸ Bagaimana dengan tarif untuk <strong>5 km</strong>?</p>
              
              <label style="display:block;margin-top:12px;margin-bottom:6px;color:#92400e;font-weight:700">Hipotesismu (Tebakan berdasarkan pola):</label>
              <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:8px">
                <label style="font-size:13px;color:#78350f">Selisih tarif per km:</label>
                <input type="number" id="hipotesisTarifPerKm" placeholder="Berapa?" style="max-width:150px;padding:8px;border:2px solid #fcd34d;border-radius:6px;background:#fff">
                <span style="font-size:13px;color:#78350f">Rupiah</span>
              </div>
              <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
                <label style="font-size:13px;color:#78350f">Prediksi tarif 4 km:</label>
                <input type="number" id="prediksi4km" placeholder="Berapa?" style="max-width:150px;padding:8px;border:2px solid #fcd34d;border-radius:6px;background:#fff">
                <span style="font-size:13px;color:#78350f">Rupiah</span>
              </div>
            </div>
          </div>

          <!-- STEP 3: Temukan Biaya Awal -->
          <div class="scenario-box" style="border-left-color:#10b981;background:#f0fdf4;margin-top:16px">
            <p style="margin:0;color:#065f46;font-weight:700">ğŸ’¡ STEP 3: Investigasi Biaya Awal</p>
            <div style="margin-top:12px;font-size:14px;color:var(--muted);line-height:1.8">
              <p style="font-weight:700;color:#059669">Pertanyaan Pembimbing:</p>
              <p>â–¸ Jika setiap km tambahan tarifnya naik <strong>[angka dari step 2]</strong>, berapa tarif untuk <strong>1 km pertama</strong>?</p>
              <p>â–¸ <em>Hint:</em> Untuk 2 km tarifnya Rp 13.000. Kalau 1 km sebelumnya (km ke-1) dihitung mundur, berapa?</p>
              <p style="font-size:12px;color:#059669;font-style:italic">ğŸ“Œ Logika: Tarif 1 km = Tarif 2 km - (Tarif per km tambahan)</p>
              
              <label style="display:block;margin-top:12px;margin-bottom:6px;color:#065f46;font-weight:700">Hipotesismu untuk Biaya Awal (tarif 1 km):</label>
              <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
                <input type="number" id="hipotesisBiayaAwal" placeholder="Berapa?" style="max-width:150px;padding:8px;border:2px solid #86efac;border-radius:6px;background:#fff">
                <span style="font-size:13px;color:#065f46">Rupiah</span>
              </div>
            </div>
          </div>

          <!-- STEP 4: Formulasikan Rumus -->
          <div class="scenario-box" style="border-left-color:#8b5cf6;background:#faf5ff;margin-top:16px">
            <p style="margin:0;color:#6b21a8;font-weight:700">ğŸ“ STEP 4: Susun Rumus Berdasarkan Temuanmu</p>
            <div style="margin-top:12px;font-size:14px;color:var(--muted);line-height:1.8">
              <p style="font-weight:700;color:#7c3aed">Pertanyaan Pembimbing:</p>
              <p>â–¸ Jika kamu sudah tahu: <strong>Tarif per km</strong> dan <strong>Biaya awal</strong>, bisakah kamu buat RUMUS untuk menghitung tarif jarak berapa saja?</p>
              <p>â–¸ Rumusnya seperti apa? (Format: Tarif = ___ Ã— Jarak + ___)</p>
              
              <label style="display:block;margin-top:12px;margin-bottom:6px;color:#6b21a8;font-weight:700">Rumus yang kamu temukan:</label>
              <div style="background:#fff;padding:12px;border:2px solid #c4b5fd;border-radius:8px;font-family:monospace;font-size:15px;color:var(--accent)">
                Tarif = 
                <input type="number" id="rumusKoef" placeholder="?" style="max-width:100px;padding:6px;border:2px solid #a78bfa;border-radius:4px;text-align:center;margin:0 4px">
                Ã— Jarak + 
                <input type="number" id="rumusKonst" placeholder="?" style="max-width:100px;padding:6px;border:2px solid #a78bfa;border-radius:4px;text-align:center;margin:0 4px">
              </div>
            </div>
          </div>

          <!-- Bot Assistant Feedback -->
          <div id="botInvestigasi" style="display:none;margin:16px 0;padding:14px;background:#fff3d9;border-left:4px solid #ffb84d;border-radius:8px;animation:fadeIn 0.4s ease-out">
            <div style="display:flex;align-items:flex-start;gap:12px">
              <div style="font-size:32px">ğŸ¤–</div>
              <div>
                <div style="font-weight:700;color:var(--accent);margin-bottom:4px">Asisten Pembimbing</div>
                <div id="botMsgInvestigasi" style="color:var(--muted);font-size:14px"></div>
              </div>
            </div>
          </div>

          <div id="feedbackEksplorasi" class="feedback-box"></div>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:20px;flex-wrap:wrap">
            <button class="btn ghost" onclick="show('identitas-kelompok')">âŸµ Kembali</button>
            <button class="btn" id="btnValidasiInvestigasi" style="flex:1;min-width:200px">âœ“ Validasi Hasil Investigasi</button>
             <button class="btn" onclick="show('scratchpad')">Lanjut ke Penyelidikan âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide 3: Formula Discovery & Validation -->
      <section class="slide" id="scratchpad">
        <div class="card-lite">
          <h2>ğŸ“ Rumus Tarif yang Kamu Temukan</h2>
          <p style="color:var(--muted)">Berdasarkan eksplorasi, tuliskan rumus yang kamu temukan, lalu validasi dengan data tambahan.</p>

          <div class="scratchpad">
            <p style="margin:0;color:var(--accent);font-weight:700">Rumus Penemuanmu:</p>
            <div style="margin:12px 0;padding:12px;background:#f9fafb;border-left:4px solid var(--info);border-radius:6px">
              <div style="font-family:monospace;font-size:14px;color:var(--accent);margin-bottom:12px">
                f(x) = <input type="number" id="koefInput" placeholder="Koefisien" style="max-width:120px"> Ã— x + <input type="number" id="konstInput" placeholder="Konstanta" style="max-width:120px">
              </div>
              
            </div>

            <p style="margin:16px 0 8px 0;color:var(--accent);font-weight:700">ğŸ§ª Validasi Rumusmu dengan Data Lain:</p>
            <p style="font-size:14px;color:var(--muted);margin:8px 0">Aplikasi GoRide memberikan informasi tarif tambahan. Cek apakah rumusmu sesuai:</p>
            
            <table class="data-table" style="margin:12px 0">
              <thead>
                <tr>
                  <th>x (Jarak, km)</th>
                  <th>Tarif Sebenarnya (dari Aplikasi)</th>
                  <th>Tarif Menurut Rumusmu</th>
                  <th>Cocok?</th>
                </tr>
              </thead>
              <tbody>
                <tr data-x="4">
                  <td style="text-align:center"><strong>4</strong></td>
                  <td style="text-align:center"><strong>21.000</strong></td>
                  <td style="text-align:center"><span class="rumusHasil" data-x="4">â€”</span></td>
                  <td style="text-align:center"><span class="statusCokok" data-x="4">?</span></td>
                </tr>
                <tr data-x="5">
                  <td style="text-align:center"><strong>5</strong></td>
                  <td style="text-align:center"><strong>25.000</strong></td>
                  <td style="text-align:center"><span class="rumusHasil" data-x="5">â€”</span></td>
                  <td style="text-align:center"><span class="statusCokok" data-x="5">?</span></td>
                </tr>
                <tr data-x="10">
                  <td style="text-align:center"><strong>10</strong></td>
                  <td style="text-align:center"><strong>45.000</strong></td>
                  <td style="text-align:center"><span class="rumusHasil" data-x="10">â€”</span></td>
                  <td style="text-align:center"><span class="statusCokok" data-x="10">?</span></td>
                </tr>
              </tbody>
            </table>

            <button class="btn" id="btnHitungRumus" style="padding:10px 16px;margin-top:12px">Cek Rumusmu</button>
            <button class="btn ghost" id="btnResetRumus" style="padding:10px 16px;margin-left:8px">Reset</button>

            <div id="feedbackRumus" class="feedback-box"></div>
          </div>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:20px;flex-wrap:wrap">
            <button class="btn ghost" onclick="show('skenario')">âŸµ Kembali</button>
            <button class="btn" onclick="show('analisisKomponen')">Lanjut: Penjelasan Bagian-Bagian Rumus âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide 6: Penjelasan Bagian-Bagian Rumus -->
      <section class="slide" id="analisisKomponen">
        <div class="card-lite">
          <h2>ğŸ” Penjelasan Bagian-Bagian Rumus</h2>
          <p style="color:var(--muted)">Mari kita pahami apa arti setiap bagian rumusmu dalam konteks bisnis ojek online.</p>

          <div class="scenario-box">
            <strong>Rumusmu: <span id="rumusKomponen">â€”</span></strong>
          </div>

          <div style="display:flex;gap:20px;flex-wrap:wrap;margin-top:20px">
            <div style="flex:1;min-width:280px;background:#e0f2fe;border-left:4px solid var(--info);padding:14px;border-radius:8px">
              <h4 style="margin:0 0 8px 0;color:var(--info)">ğŸ“Œ Koefisien (Angka didepan x)</h4>
              <div style="background:#fff;padding:10px;border-radius:6px;margin:8px 0;font-weight:700;color:var(--accent)">
                <span id="nilaiKoef">â€”</span> Rupiah/km
              </div>
              <p style="margin:0;font-size:13px;color:#0c4a6e">Ini adalah <strong>tarif tambahan untuk setiap kilometer</strong> perjalanan. Semakin jauh jarak, semakin besar tarif ini.</p>
            </div>

            <div style="flex:1;min-width:280px;background:#fef3c7;border-left:4px solid var(--warning);padding:14px;border-radius:8px">
              <h4 style="margin:0 0 8px 0;color:#92400e">ğŸ“Œ Konstanta (Angka yang berdiri sendiri)</h4>
              <div style="background:#fff;padding:10px;border-radius:6px;margin:8px 0;font-weight:700;color:var(--accent)">
                Rp <span id="nilaiKonst">â€”</span>
              </div>
              <p style="margin:0;font-size:13px;color:#78350f">Ini adalah <strong>biaya awal/aplikasi</strong> yang selalu dikenakan, apapun jaraknya. Ini seperti "asuransi" perjalanan Anda.</p>
            </div>
          </div>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:20px;flex-wrap:wrap">
            <button class="btn ghost" onclick="show('scratchpad')">âŸµ Kembali</button>
            <button class="btn" onclick="show('penyajian-rumus')">Lanjut: Penyajian Hasil Karya âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide: Fase 4 - Penyajian Hasil Karya -->
      <section class="slide" id="penyajian-rumus">
        <div class="card-lite">
          <h2>ğŸ¨ Fase 4: Penyajian Hasil Karya (Gallery Walk)</h2>
          <p style="color:var(--muted);margin-bottom:20px">
            Buat diagram kartesius untuk menunjukkan hubungan jarak dan tarif secara visual!
          </p>

          <!-- BAGIAN A: BUAT DIAGRAM KARTESIUS -->
          <div class="card-lite">
            <h3 style="color:var(--accent);margin-bottom:12px">ğŸ“ˆ A. Buat Diagram Kartesius</h3>
            <p style="color:var(--muted);font-size:14px;margin-bottom:12px">
              Kelompokmu sudah menemukan rumus f(x) = 4000x + 5000. Sekarang buat diagram kartesius untuk menggambarkan fungsi ini!
            </p>
            
            <!-- Info panel -->
            <div style="background:#e3f2fd;border-left:4px solid #2196f3;padding:12px;border-radius:8px;margin-bottom:16px">
              <strong>ğŸ’¡ Cara Membuat Grafik:</strong>
              <ol style="margin:8px 0;padding-left:20px;font-size:13px;line-height:1.6">
                <li>Masukkan pasangan (jarak, tarif) di tabel input</li>
                <li>Klik "Plot Titik-Titik" untuk menggambar di canvas</li>
                <li>Klik "Gambar Garis" untuk menghubungkan titik dengan garis lurus</li>
                <li>Klik "Simpan Grafik" untuk menyimpan ke Gallery Walk</li>
              </ol>
            </div>

            <!-- Input titik koordinat -->
            <div style="background:#fff;padding:16px;border:2px solid #e0e0e0;border-radius:8px;margin-bottom:16px">
              <h4 style="margin-top:0;color:var(--accent)">Input Data Titik (x, y)</h4>
              <div id="inputTitikContainer" style="display:grid;gap:10px;margin-bottom:12px">
                <!-- Baris input default -->
                <div style="display:flex;gap:8px;align-items:center">
                  <input type="number" class="titik-x" placeholder="Jarak (x)" value="0" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
                  <input type="number" class="titik-y" placeholder="Tarif (y)" value="5000" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
                  <button class="btn ghost" onclick="hapusBarisTitik(this)" style="padding:6px 12px;font-size:13px">ğŸ—‘ï¸</button>
                </div>
                <div style="display:flex;gap:8px;align-items:center">
                  <input type="number" class="titik-x" placeholder="Jarak (x)" value="5" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
                  <input type="number" class="titik-y" placeholder="Tarif (y)" value="25000" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
                  <button class="btn ghost" onclick="hapusBarisTitik(this)" style="padding:6px 12px;font-size:13px">ğŸ—‘ï¸</button>
                </div>
                <div style="display:flex;gap:8px;align-items:center">
                  <input type="number" class="titik-x" placeholder="Jarak (x)" value="10" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
                  <input type="number" class="titik-y" placeholder="Tarif (y)" value="45000" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
                  <button class="btn ghost" onclick="hapusBarisTitik(this)" style="padding:6px 12px;font-size:13px">ğŸ—‘ï¸</button>
                </div>
              </div>
              <button class="btn ghost" id="btnTambahTitik" style="width:100%;font-size:14px">+ Tambah Titik</button>
            </div>

            <!-- Canvas grafik -->
            <div style="background:#fff;border:2px solid #2196f3;border-radius:8px;padding:16px;margin-bottom:16px">
              <canvas id="canvasKartesius" width="600" height="400" style="width:100%;max-width:600px;height:auto;border:1px solid #ddd;border-radius:4px;display:block;margin:0 auto"></canvas>
            </div>

            <!-- Tombol aksi -->
            <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:16px">
              <button class="btn" id="btnPlotTitik" style="background:#2196f3">ğŸ“ Plot Titik-Titik</button>
              <button class="btn" id="btnGambarGaris" style="background:#4caf50">ğŸ“ Gambar Garis</button>
              <button class="btn ghost" id="btnResetCanvas" style="border-color:#f57c00;color:#f57c00">ğŸ”„ Reset Canvas</button>
            </div>

            <!-- Penjelasan grafik -->
            <div style="margin-bottom:16px">
              <label style="display:block;font-weight:bold;margin-bottom:6px;font-size:14px">Penjelasan Grafik (opsional):</label>
              <textarea id="penjelasanGrafik" 
                placeholder="Jelaskan apa yang ditunjukkan grafik ini... (contoh: Grafik menunjukkan hubungan linear antara jarak dan tarif. Semakin jauh jarak, semakin tinggi tarif.)"
                style="width:100%;padding:10px;border-radius:8px;border:2px solid #ddd;font-family:Arial;font-size:14px;min-height:70px;resize:vertical"></textarea>
            </div>

            <button class="btn" id="btnSimpanGrafik" style="background:#2e7d32;width:100%;font-size:16px">ğŸ’¾ Simpan Grafik untuk Gallery Walk</button>
            <div id="feedbackPenyajianRumus" style="margin-top:12px"></div>
          </div>

          <!-- BAGIAN B: GALLERY WALK - KOMENTAR DARI KELOMPOK LAIN -->
          <div class="card-lite" style="margin-top:20px">
            <h3 style="color:var(--accent);margin-bottom:12px">ğŸ‘¥ B. Gallery Walk: Berikan Komentar</h3>
            <p style="color:var(--muted);font-size:14px;margin-bottom:12px">
              Lihat grafik kelompok lain dan berikan komentar yang membangun!
            </p>

            <!-- Preview grafik tersimpan -->
            <div id="previewGrafikTersimpan" style="background:#f5f5f5;border:2px solid #ddd;border-radius:8px;padding:16px;margin-bottom:16px;text-align:center;display:none">
              <h4 style="margin-top:0;color:var(--accent)">Grafik Kelompok Ini:</h4>
              <img id="imgGrafikTersimpan" src="" alt="Grafik tersimpan" style="max-width:100%;height:auto;border:1px solid #ccc;border-radius:4px">
            </div>

            <div style="display:flex;gap:12px;margin-bottom:16px">
              <input type="text" id="namaKelompokKomentarRumus" 
                placeholder="Nama Kelompokmu (contoh: Kelompok 1)"
                style="flex:1;padding:10px;border-radius:8px;border:2px solid #ddd">
            </div>

            <textarea id="komentarPeerReviewRumus" 
              placeholder="Tulis komentar/saran untuk kelompok ini... (contoh: Penyajian kalian jelas! Tapi coba jelaskan arti 4000 dan 5000 di rumusnya lebih detail)"
              style="width:100%;padding:12px;border-radius:8px;border:2px solid #ddd;font-family:Arial;min-height:100px"></textarea>

            <button class="btn" id="btnKirimKomentarRumus" style="margin-top:12px">ğŸ’¬ Kirim Komentar</button>

            <!-- DAFTAR KOMENTAR -->
            <div id="daftarKomentarRumus" style="margin-top:20px">
              <h4 style="color:var(--accent);margin-bottom:12px">ğŸ“ Komentar dari Kelompok Lain:</h4>
              <div id="komentarListRumus" style="max-height:300px;overflow-y:auto">
                <p style="color:var(--muted);font-style:italic">Belum ada komentar. Jadilah yang pertama!</p>
              </div>
            </div>
          </div>

          <!-- NAVIGASI -->
          <div style="display:flex;gap:12px;justify-content:center;margin-top:24px;flex-wrap:wrap">
            <button class="btn ghost" onclick="show('analisisKomponen')">âŸµ Kembali</button>
            <button class="btn" onclick="show('evaluasi')">Lanjut ke Evaluasi âŸ¶</button>
          </div>
        </div>
      </section>

      <!-- Slide: Evaluasi & Refleksi -->
      <section class="slide" id="evaluasi">
        <div class="card-lite">
          <h2>ğŸ“ Evaluasi & Refleksi Pembelajaran</h2>
          <p style="color:var(--muted);margin-bottom:20px">Uji pemahamanmu tentang fungsi dan bagikan pengalaman belajarmu!</p>

          <!-- BAGIAN A: PILIHAN GANDA -->
          <div class="scenario-box" style="background:#fff3cd;border-left:4px solid var(--warning)">
            <h3 style="color:var(--accent);margin-top:0">ğŸ“‹ Bagian A: Evaluasi Materi (Pilihan Ganda)</h3>
            
            <!-- Soal 1 -->
            <div style="margin:16px 0;padding:12px;background:#fff;border-radius:8px">
              <p style="margin:0 0 8px 0;color:var(--accent);font-weight:700">1. Jika f(x) = 4.000x + 5.000, maka f(3) adalah...</p>
              <div style="margin:8px 0">
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal1" value="A" style="margin-right:8px">
                  A. 12.000
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal1" value="B" style="margin-right:8px">
                  B. 15.000
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal1" value="C" style="margin-right:8px">
                  C. 17.000
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal1" value="D" style="margin-right:8px">
                  D. 20.000
                </label>
              </div>
            </div>

            <!-- Soal 2 -->
            <div style="margin:16px 0;padding:12px;background:#fff;border-radius:8px">
              <p style="margin:0 0 8px 0;color:var(--accent);font-weight:700">2. Dalam fungsi f(x) = 4.000x + 5.000, angka 5.000 disebut...</p>
              <div style="margin:8px 0">
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal2" value="A" style="margin-right:8px">
                  A. Koefisien
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal2" value="B" style="margin-right:8px">
                  B. Konstanta
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal2" value="C" style="margin-right:8px">
                  C. Variabel
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal2" value="D" style="margin-right:8px">
                  D. Domain
                </label>
              </div>
            </div>

            <!-- Soal 4 -->
            <div style="margin:16px 0;padding:12px;background:#fff;border-radius:8px">
              <p style="margin:0 0 8px 0;color:var(--accent);font-weight:700">4. Himpunan pasangan berurutan berikut yang merupakan fungsi adalah...</p>
              <div style="margin:8px 0">
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal4" value="A" style="margin-right:8px">
                  A. {(1,2), (1,3), (2,4)}
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal4" value="B" style="margin-right:8px">
                  B. {(1,2), (2,2), (3,4)}
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal4" value="C" style="margin-right:8px">
                  C. {(1,2), (2,3), (1,4)}
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal4" value="D" style="margin-right:8px">
                  D. {(1,2), (1,2), (3,4)}
                </label>
              </div>
            </div>

            <!-- Soal 5 -->
            <div style="margin:16px 0;padding:12px;background:#fff;border-radius:8px">
              <p style="margin:0 0 8px 0;color:var(--accent);font-weight:700">5. Fungsi dapat disajikan dalam bentuk berikut, KECUALI...</p>
              <div style="margin:8px 0">
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal5" value="A" style="margin-right:8px">
                  A. Diagram panah
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal5" value="B" style="margin-right:8px">
                  B. Tabel
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal5" value="C" style="margin-right:8px">
                  C. Diagram lingkaran
                </label>
                <label style="display:block;margin:6px 0;cursor:pointer">
                  <input type="radio" name="soal5" value="D" style="margin-right:8px">
                  D. Grafik
                </label>
              </div>
            </div>

            <button class="btn" id="btnCekEvaluasi" style="width:100%;padding:12px;margin-top:16px">âœ“ Cek Jawaban</button>
            <div id="feedbackEvaluasi" class="feedback-box"></div>
          </div>

          <!-- BAGIAN B: REFLEKSI -->
          <div class="scenario-box" style="background:#e0f2fe;border-left:4px solid var(--info);margin-top:20px">
            <h3 style="color:var(--accent);margin-top:0">ğŸ’­ Bagian B: Refleksi Pembelajaran</h3>
            
            <p style="margin:12px 0;color:var(--accent);font-weight:700">Bagaimana pengalaman belajarmu hari ini?</p>
            
            <!-- Emoji Rating -->
            <div style="text-align:center;margin:20px 0">
              <p style="margin:0 0 12px 0;color:var(--muted);font-size:14px">Pilih emoji yang menggambarkan perasaanmu:</p>
              <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap">
                <button class="emoji-btn" data-rating="5" style="font-size:48px;border:3px solid transparent;background:transparent;cursor:pointer;border-radius:50%;padding:8px;transition:all 0.3s">ğŸ˜Š</button>
                <button class="emoji-btn" data-rating="4" style="font-size:48px;border:3px solid transparent;background:transparent;cursor:pointer;border-radius:50%;padding:8px;transition:all 0.3s">ğŸ™‚</button>
                <button class="emoji-btn" data-rating="3" style="font-size:48px;border:3px solid transparent;background:transparent;cursor:pointer;border-radius:50%;padding:8px;transition:all 0.3s">ğŸ˜</button>
                <button class="emoji-btn" data-rating="2" style="font-size:48px;border:3px solid transparent;background:transparent;cursor:pointer;border-radius:50%;padding:8px;transition:all 0.3s">ğŸ˜•</button>
                <button class="emoji-btn" data-rating="1" style="font-size:48px;border:3px solid transparent;background:transparent;cursor:pointer;border-radius:50%;padding:8px;transition:all 0.3s">ğŸ˜¢</button>
              </div>
              <p id="emojiLabel" style="margin:12px 0;color:var(--accent);font-weight:700;min-height:24px"></p>
            </div>

            <!-- Text Box Refleksi -->
            <div style="margin:16px 0">
              <label style="display:block;margin-bottom:8px;color:var(--accent);font-weight:700">Ceritakan pengalamanmu:</label>
              <textarea id="refleksiPembelajaran" placeholder="Apa yang paling menarik? Bagian mana yang sulit? Apa yang kamu pelajari hari ini?" style="width:100%;min-height:100px;padding:12px;border:2px solid #d1d5db;border-radius:8px;font-family:Arial,sans-serif;font-size:14px;box-sizing:border-box"></textarea>
            </div>

            <button class="btn" id="btnSimpanRefleksi" style="width:100%;padding:12px">ğŸ’¾ Simpan Refleksi</button>
            <div id="feedbackRefleksi" class="feedback-box"></div>
          </div>

          <!-- BAGIAN G: REFLEKSI INDIVIDU MENDALAM -->
          <div class="scenario-box" style="background:#fff9f0;border-left:4px solid #ffcb64;margin-top:20px;border:3px solid #ffcb64">
            <h3 style="color:var(--accent);margin-top:0">ğŸ¤” Bagian G: Refleksi Individu Mendalam</h3>
            <p style="color:var(--muted);margin-bottom:12px;font-size:14px">Jawab pertanyaan berikut dengan jujur untuk memahami pembelajaran kalian dengan lebih dalam:</p>
            
            <div style="margin-bottom:14px">
              <div style="font-weight:600;color:var(--accent);margin-bottom:6px">1ï¸âƒ£ Bagian mana dari konsep fungsi linear (f(x) = ax + b) yang paling membingungkan bagimu?</div>
              <textarea id="refleksi7" placeholder="Jelaskan mana yang masih membuat kalian bingung (contoh: perbedaan koefisien vs konstanta, cara membaca grafik, dll)..." style="width:100%;height:100px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.12);font-size:14px;box-sizing:border-box;background:#fff"></textarea>
            </div>
            
            <div style="margin-bottom:14px">
              <div style="font-weight:600;color:var(--accent);margin-bottom:6px">2ï¸âƒ£ Kesalahan apa yang sempat kalian lakukan saat mencari pola tarif atau membuat rumus?</div>
              <textarea id="refleksi8" placeholder="Ceritakan kesalahan yang pernah terjadi saat investigasi (contoh: awalnya salah menghitung selisih tarif, lupa hitung biaya awal, dll)..." style="width:100%;height:100px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.12);font-size:14px;box-sizing:border-box;background:#fff"></textarea>
            </div>
            
            <div style="margin-bottom:14px">
              <div style="font-weight:600;color:var(--accent);margin-bottom:6px">3ï¸âƒ£ Mengapa menurutmu pemahaman tentang fungsi linear ini belum sepenuhnya kalian kuasai? Apa yang masih perlu dipelajari?</div>
              <textarea id="refleksi9" placeholder="Jelaskan aspek apa yang masih perlu diperdalam untuk memahami fungsi linear dengan lebih baik..." style="width:100%;height:100px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.12);font-size:14px;box-sizing:border-box;background:#fff"></textarea>
            </div>
          </div>

          <!-- KIRIM KE GURU -->
          <div class="scenario-box" style="background:#e8f5e9;border-left:4px solid #4caf50;margin-top:20px;text-align:center;">
            <h3 style="color:#2e7d32;margin-top:0;">ğŸ“¤ Kirim Hasil Pembelajaran</h3>
            <p style="color:var(--muted);margin:8px 0;font-size:14px;">Kirim hasil pengerjaan Anda ke guru dalam format PDF melalui Google Form</p>
            <button class="btn" onclick="generatePDFReport()" style="padding:14px 30px;font-size:16px;margin:10px auto;">
              ğŸ“¤ Kirim Hasil ke Guru
            </button>
            <p style="font-size:12px;color:#666;margin-top:10px;">
              PDF akan berisi evaluasi, refleksi, dan ringkasan pembelajaran Anda
            </p>
            <div id="feedbackDownload" class="feedback-box" style="margin-top:12px"></div>
          </div>

          <div style="display:flex;gap:10px;justify-content:center;margin-top:20px;flex-wrap:wrap">
            <button class="btn ghost" onclick="show('penyajian-rumus')">âŸµ Kembali</button>
          </div>
        </div>
      </section>

    </main>
  </div>
</div>

<script>
function show(id) {
  document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
  window.scrollTo(0, 0);
}

// Global untuk menyimpan rumus yang ditemukan siswa
let discoveredFormula = { coef: null, const: null };

document.addEventListener('DOMContentLoaded', () => {
  
  // ======== FASE 3: MEMBIMBING PENYELIDIKAN (INVESTIGASI GUIDED) ========
  const btnValidasiInvestigasi = document.getElementById('btnValidasiInvestigasi');
  const feedbackEksplorasi = document.getElementById('feedbackEksplorasi');
  const botInvestigasi = document.getElementById('botInvestigasi');
  const botMsgInvestigasi = document.getElementById('botMsgInvestigasi');

  function showBotInvestigasi(message) {
    if (botInvestigasi && botMsgInvestigasi) {
      botMsgInvestigasi.textContent = message;
      botInvestigasi.style.display = 'block';
      setTimeout(() => {
        botInvestigasi.style.display = 'none';
      }, 10000);
    }
  }

  btnValidasiInvestigasi?.addEventListener('click', () => {
    // Ambil semua input investigasi
    const observasi = document.getElementById('observasiData')?.value.trim();
    const tarifPerKm = parseInt(document.getElementById('hipotesisTarifPerKm')?.value || '0');
    const prediksi4km = parseInt(document.getElementById('prediksi4km')?.value || '0');
    const biayaAwal = parseInt(document.getElementById('hipotesisBiayaAwal')?.value || '0');
    const rumusKoef = parseInt(document.getElementById('rumusKoef')?.value || '0');
    const rumusKonst = parseInt(document.getElementById('rumusKonst')?.value || '0');

    // Validasi minimal observasi ditulis
    if (!observasi || observasi.length < 20) {
      feedbackEksplorasi.textContent = 'ğŸ’­ STEP 1 belum terisi. Coba lihat data: 2 km â†’ Rp 13.000 dan 3 km â†’ Rp 17.000';
      feedbackEksplorasi.className = 'feedback-box warning';
      showBotInvestigasi('Apa yang menarik dari kedua data ini? Coba tuliskan apapun yang kalian amati!');
      return;
    }

    // Validasi STEP 2: Tarif per km
    if (tarifPerKm !== 4000) {
      feedbackEksplorasi.textContent = 'ğŸ¤” Hmm, coba bandingkan tarif 2 km dengan 3 km. Apa yang berubah ketika jarak bertambah 1 km?';
      feedbackEksplorasi.className = 'feedback-box warning';
      showBotInvestigasi('Kalau 2 km = Rp 13.000 dan 3 km = Rp 17.000, berapa selisihnya? Selisih itu artinya tarif bertambah berapa per km?');
      return;
    }

    // Validasi STEP 2: Prediksi 4 km
    if (prediksi4km !== 21000) {
      feedbackEksplorasi.textContent = 'ğŸ¤” Jika pola yang kalian temukan konsisten, bagaimana cara menghitung tarif 4 km dari data 3 km?';
      feedbackEksplorasi.className = 'feedback-box warning';
      showBotInvestigasi('Kalian sudah tahu tarif 3 km dan berapa penambahan per km. Coba gunakan pola itu untuk prediksi!');
      return;
    }

    // Validasi STEP 3: Biaya awal
    if (biayaAwal !== 5000) {
      feedbackEksplorasi.textContent = 'ğŸ¤” Coba pikirkan: kalau tarif 2 km adalah Rp 13.000, dan km ke-2 menambah Rp 4.000, berapa tarif km pertama?';
      feedbackEksplorasi.className = 'feedback-box warning';
      showBotInvestigasi('Hint: Coba hitung mundur dari 2 km. Tarif 2 km dikurangi penambahan 1 km = ?');
      return;
    }

    // Validasi STEP 4: Rumus
    if (rumusKoef !== 4000 || rumusKonst !== 5000) {
      feedbackEksplorasi.textContent = 'ğŸ¤” Lihat lagi hasil investigasi di STEP 2 dan STEP 3. Bagaimana menggabungkannya jadi satu rumus?';
      feedbackEksplorasi.className = 'feedback-box warning';
      showBotInvestigasi('Kalian sudah punya: penambahan per km dan biaya km pertama. Coba susun pola: Tarif = ... Ã— Jarak + ...');
      return;
    }

    // SEMUA BENAR - Investigasi Sukses!
    discoveredFormula.coef = 4000;
    discoveredFormula.const = 5000;

    feedbackEksplorasi.textContent = 'ğŸ‰ LUAR BIASA! Investigasi kelompokmu berhasil! Kalian telah menemukan:\nâ€¢ Tarif per km = Rp 4.000\nâ€¢ Biaya awal = Rp 5.000\nâ€¢ Rumus: Tarif = 4.000 Ã— Jarak + 5.000\n\nSekarang lanjut validasi rumus dengan data lain!';
    feedbackEksplorasi.className = 'feedback-box success';

    showBotInvestigasi('Proses investigasi kalian sangat sistematis! Kalian mengamati data â†’ menemukan pola â†’ prediksi â†’ menemukan biaya awal â†’ susun rumus. Ini adalah cara ilmuwan bekerja! ğŸ”¬');

    // Simpan hasil investigasi
    localStorage.setItem('investigasiFase3', JSON.stringify({
      observasi: observasi,
      tarifPerKm: tarifPerKm,
      prediksi4km: prediksi4km,
      biayaAwal: biayaAwal,
      rumus: `Tarif = ${rumusKoef} Ã— Jarak + ${rumusKonst}`,
      timestamp: new Date().toISOString()
    }));

    // Enable navigasi ke scratchpad
    setTimeout(() => {
      const btn = document.querySelector('button[onclick*="scratchpad"]');
      if (btn) {
        btn.disabled = false;
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
      }
    }, 500);
  });

  // ======== SLIDE 3: VALIDASI RUMUS DENGAN DATA TAMBAHAN ========
  const koefInput = document.getElementById('koefInput');
  const konstInput = document.getElementById('konstInput');
  const btnHitungRumus = document.getElementById('btnHitungRumus');
  const btnResetRumus = document.getElementById('btnResetRumus');
  const btnLanjutKeScratchpad = document.getElementById('btnLanjutKeScratchpad');
  const feedbackRumus = document.getElementById('feedbackRumus');

  btnHitungRumus?.addEventListener('click', () => {
    const koef = parseInt(koefInput?.value || '0');
    const konst = parseInt(konstInput?.value || '0');

    if (koef === 0 || konst === 0) {
      feedbackRumus.textContent = 'âš ï¸ Lengkapi koefisien dan konstanta terlebih dahulu!';
      feedbackRumus.className = 'feedback-box warning';
      return;
    }

    // Test dengan data sebenarnya
    const testData = [
      { x: 4, expected: 21000 },
      { x: 5, expected: 25000 },
      { x: 10, expected: 45000 }
    ];

    let allCorrect = true;
    testData.forEach(data => {
      const hasil = koef * data.x + konst;
      const row = document.querySelector(`tr[data-x="${data.x}"]`);

  // ======== FASE 4: PENYAJIAN HASIL KARYA (GALLERY WALK - DIAGRAM KARTESIUS) ========
  const canvasKartesius = document.getElementById('canvasKartesius');
  const ctxKartesius = canvasKartesius?.getContext('2d');
  const btnTambahTitik = document.getElementById('btnTambahTitik');
  const btnPlotTitik = document.getElementById('btnPlotTitik');
  const btnGambarGaris = document.getElementById('btnGambarGaris');
  const btnResetCanvas = document.getElementById('btnResetCanvas');
  const btnSimpanGrafik = document.getElementById('btnSimpanGrafik');
  const btnKirimKomentarRumus = document.getElementById('btnKirimKomentarRumus');
  const feedbackPenyajianRumus = document.getElementById('feedbackPenyajianRumus');
  const komentarListRumus = document.getElementById('komentarListRumus');
  const previewGrafikTersimpan = document.getElementById('previewGrafikTersimpan');
  const imgGrafikTersimpan = document.getElementById('imgGrafikTersimpan');

  let titikPlotted = [];

  // Fungsi hapus baris titik
  window.hapusBarisTitik = function(btn) {
    const container = document.getElementById('inputTitikContainer');
    if (container.children.length > 1) {
      btn.closest('div').remove();
    } else {
      alert('âš ï¸ Minimal harus ada 1 titik!');
    }
  };

  // Tambah baris input titik
  btnTambahTitik?.addEventListener('click', () => {
    const container = document.getElementById('inputTitikContainer');
    const newRow = document.createElement('div');
    newRow.style.cssText = 'display:flex;gap:8px;align-items:center';
    newRow.innerHTML = `
      <input type="number" class="titik-x" placeholder="Jarak (x)" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
      <input type="number" class="titik-y" placeholder="Tarif (y)" style="flex:1;padding:8px;border-radius:6px;border:1.5px solid #ddd;font-size:14px">
      <button class="btn ghost" onclick="hapusBarisTitik(this)" style="padding:6px 12px;font-size:13px">ğŸ—‘ï¸</button>
    `;
    container.appendChild(newRow);
  });

  // Inisialisasi canvas
  function initCanvas() {
    if (!ctxKartesius) return;
    
    const width = canvasKartesius.width;
    const height = canvasKartesius.height;
    
    // Clear canvas
    ctxKartesius.clearRect(0, 0, width, height);
    
    // Background
    ctxKartesius.fillStyle = '#fafafa';
    ctxKartesius.fillRect(0, 0, width, height);
    
    // Grid
    ctxKartesius.strokeStyle = '#e0e0e0';
    ctxKartesius.lineWidth = 1;
    for (let i = 0; i <= 10; i++) {
      // Vertical
      ctxKartesius.beginPath();
      ctxKartesius.moveTo(50 + i * 50, 20);
      ctxKartesius.lineTo(50 + i * 50, height - 40);
      ctxKartesius.stroke();
      // Horizontal
      ctxKartesius.beginPath();
      ctxKartesius.moveTo(50, 20 + i * 34);
      ctxKartesius.lineTo(width - 20, 20 + i * 34);
      ctxKartesius.stroke();
    }
    
    // Axes
    ctxKartesius.strokeStyle = '#333';
    ctxKartesius.lineWidth = 2;
    // X-axis
    ctxKartesius.beginPath();
    ctxKartesius.moveTo(50, height - 40);
    ctxKartesius.lineTo(width - 20, height - 40);
    ctxKartesius.stroke();
    // Y-axis
    ctxKartesius.beginPath();
    ctxKartesius.moveTo(50, 20);
    ctxKartesius.lineTo(50, height - 40);
    ctxKartesius.stroke();
    
    // Labels
    ctxKartesius.fillStyle = '#333';
    ctxKartesius.font = 'bold 12px Arial';
    ctxKartesius.fillText('Jarak (km)', width / 2 - 30, height - 10);
    ctxKartesius.save();
    ctxKartesius.translate(15, height / 2);
    ctxKartesius.rotate(-Math.PI / 2);
    ctxKartesius.fillText('Tarif (Rp)', -40, 0);
    ctxKartesius.restore();
    
    // Scale labels
    ctxKartesius.font = '10px Arial';
    ctxKartesius.fillStyle = '#666';
    for (let i = 0; i <= 10; i++) {
      // X labels
      ctxKartesius.fillText(i, 45 + i * 50, height - 25);
      // Y labels
      const yVal = (10 - i) * 5000;
      ctxKartesius.fillText(yVal / 1000 + 'k', 10, 25 + i * 34);
    }
  }

  // Plot titik-titik
  btnPlotTitik?.addEventListener('click', () => {
    const inputsX = document.querySelectorAll('.titik-x');
    const inputsY = document.querySelectorAll('.titik-y');
    
    titikPlotted = [];
    inputsX.forEach((inputX, idx) => {
      const x = parseFloat(inputX.value);
      const y = parseFloat(inputsY[idx].value);
      
      if (!isNaN(x) && !isNaN(y)) {
        titikPlotted.push({ x, y });
      }
    });
    
    if (titikPlotted.length === 0) {
      alert('âš ï¸ Masukkan minimal 1 titik yang valid!');
      return;
    }
    
    // Redraw canvas
    initCanvas();
    
    // Plot points
    ctxKartesius.fillStyle = '#2196f3';
    titikPlotted.forEach(point => {
      const canvasX = 50 + (point.x * 50);
      const canvasY = (canvasKartesius.height - 40) - (point.y / 5000 * 34);
      
      ctxKartesius.beginPath();
      ctxKartesius.arc(canvasX, canvasY, 5, 0, Math.PI * 2);
      ctxKartesius.fill();
      
      // Label
      ctxKartesius.fillStyle = '#000';
      ctxKartesius.font = '10px Arial';
      ctxKartesius.fillText(`(${point.x}, ${point.y})`, canvasX + 8, canvasY - 8);
      ctxKartesius.fillStyle = '#2196f3';
    });
    
    feedbackPenyajianRumus.innerHTML = '<div class="feedback-box success">âœ… Titik-titik berhasil diplot! Sekarang klik "Gambar Garis" untuk menghubungkannya.</div>';
  });

  // Gambar garis
  btnGambarGaris?.addEventListener('click', () => {
    if (titikPlotted.length < 2) {
      alert('âš ï¸ Plot minimal 2 titik terlebih dahulu!');
      return;
    }
    
    // Sort by x
    titikPlotted.sort((a, b) => a.x - b.x);
    
    // Draw line
    ctxKartesius.strokeStyle = '#4caf50';
    ctxKartesius.lineWidth = 2;
    ctxKartesius.beginPath();
    
    titikPlotted.forEach((point, idx) => {
      const canvasX = 50 + (point.x * 50);
      const canvasY = (canvasKartesius.height - 40) - (point.y / 5000 * 34);
      
      if (idx === 0) {
        ctxKartesius.moveTo(canvasX, canvasY);
      } else {
        ctxKartesius.lineTo(canvasX, canvasY);
      }
    });
    
    ctxKartesius.stroke();
    
    feedbackPenyajianRumus.innerHTML = '<div class="feedback-box success">âœ… Garis linear berhasil digambar! Sekarang klik "Simpan Grafik".</div>';
  });

  // Reset canvas
  btnResetCanvas?.addEventListener('click', () => {
    titikPlotted = [];
    initCanvas();
    feedbackPenyajianRumus.innerHTML = '';
  });

  // Simpan grafik
  btnSimpanGrafik?.addEventListener('click', () => {
    if (titikPlotted.length === 0) {
      alert('âš ï¸ Plot titik dan gambar garis terlebih dahulu!');
      return;
    }
    
    const penjelasan = document.getElementById('penjelasanGrafik')?.value.trim() || '';
    
    // Convert canvas to image
    const grafikDataUrl = canvasKartesius.toDataURL('image/png');
    
    const grafikData = {
      image: grafikDataUrl,
      penjelasan: penjelasan,
      titik: titikPlotted,
      timestamp: new Date().toLocaleString('id-ID')
    };
    
    localStorage.setItem('grafikKartesiusKelompok', JSON.stringify(grafikData));
    
    feedbackPenyajianRumus.innerHTML = `
      <div class="feedback-box success">
        âœ… Grafik berhasil disimpan!
        <br><small>Sekarang kelompok lain bisa melihat dan memberikan komentar di Gallery Walk!</small>
      </div>
    `;
    
    // Show preview
    if (previewGrafikTersimpan && imgGrafikTersimpan) {
      imgGrafikTersimpan.src = grafikDataUrl;
      previewGrafikTersimpan.style.display = 'block';
    }
  });

  // Load grafik tersimpan saat slide dibuka
  function loadGrafikTersimpan() {
    const saved = localStorage.getItem('grafikKartesiusKelompok');
    if (saved) {
      const data = JSON.parse(saved);
      if (previewGrafikTersimpan && imgGrafikTersimpan) {
        imgGrafikTersimpan.src = data.image;
        previewGrafikTersimpan.style.display = 'block';
      }
    }
  }

  // Initialize canvas on load
  if (canvasKartesius) {
    initCanvas();
    loadGrafikTersimpan();
  }

  // Load komentar dari localStorage
  let daftarKomentarRumus = JSON.parse(localStorage.getItem('komentarPeerReviewRumus') || '[]');

  function tampilkanKomentarRumus() {
    if (daftarKomentarRumus.length === 0) {
      komentarListRumus.innerHTML = '<p style="color:var(--muted);font-style:italic">Belum ada komentar. Jadilah yang pertama!</p>';
      return;
    }
    
    komentarListRumus.innerHTML = daftarKomentarRumus.map((k, idx) => `
      <div class="komentar-item">
        <div class="komentar-header">
          <span class="komentar-kelompok">ğŸ‘¥ ${k.kelompok}</span>
          <span class="komentar-waktu">${k.waktu}</span>
        </div>
        <div class="komentar-isi">${k.komentar}</div>
      </div>
    `).join('');
  }

  // Kirim komentar
  btnKirimKomentarRumus?.addEventListener('click', () => {
    const namaKelompok = document.getElementById('namaKelompokKomentarRumus')?.value.trim();
    const komentar = document.getElementById('komentarPeerReviewRumus')?.value.trim();
    
    if (!namaKelompok) {
      alert('âš ï¸ Tulis nama kelompokmu dulu!');
      return;
    }
    
    if (!komentar || komentar.length < 15) {
      alert('âš ï¸ Komentar terlalu singkat! Berikan saran yang membangun (minimal 15 karakter)');
      return;
    }
    
    const komentarBaru = {
      kelompok: namaKelompok,
      komentar: komentar,
      waktu: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
    };
    
    daftarKomentarRumus.push(komentarBaru);
    localStorage.setItem('komentarPeerReviewRumus', JSON.stringify(daftarKomentarRumus));
    
    // Reset input
    document.getElementById('komentarPeerReviewRumus').value = '';
    
    // Tampilkan komentar
    tampilkanKomentarRumus();
    
    // Notifikasi sukses
    alert(`âœ… Komentar dari "${namaKelompok}" berhasil dikirim!`);
  });

  // Load komentar saat halaman dibuka
  if (komentarListRumus) {
    tampilkanKomentarRumus();
  }

      const hasilSpan = row?.querySelector('.rumusHasil');
      const statusSpan = row?.querySelector('.statusCokok');

      hasilSpan.textContent = hasil.toLocaleString('id-ID');

      if (hasil === data.expected) {
        statusSpan.textContent = 'âœ”';
        statusSpan.style.color = 'var(--success)';
      } else {
        statusSpan.textContent = 'âœ–';
        statusSpan.style.color = 'var(--danger)';
        allCorrect = false;
      }
    });

    if (allCorrect) {
      feedbackRumus.textContent = 'âœ… TEPAT! Rumusmu f(x) = ' + koef.toLocaleString('id-ID') + 'x + ' + konst.toLocaleString('id-ID') + ' sudah tervalidasi!';
      feedbackRumus.className = 'feedback-box success';
      
      // Simpan formula
      discoveredFormula.coef = koef;
      discoveredFormula.const = konst;
      
      // Enable tombol lanjut
      if (btnLanjutKeScratchpad) {
        btnLanjutKeScratchpad.disabled = false;
        btnLanjutKeScratchpad.style.opacity = '1';
        btnLanjutKeScratchpad.style.cursor = 'pointer';
      }
    } else {
      feedbackRumus.textContent = 'âŒ Belum cocok dengan semua data. Coba perbaiki koefisien atau konstanta.';
      feedbackRumus.className = 'feedback-box error';
    }
  });

  btnResetRumus?.addEventListener('click', () => {
    koefInput.value = '';
    konstInput.value = '';
    document.querySelectorAll('.rumusHasil').forEach(el => el.textContent = 'â€”');
    document.querySelectorAll('.statusCokok').forEach(el => el.textContent = '?');
    feedbackRumus.className = 'feedback-box';
  });

  // Link tombol lanjut ke Puzzle slide
  if (btnLanjutKeScratchpad) {
    btnLanjutKeScratchpad.addEventListener('click', () => show('analisis'));
  }

  // ======== SLIDE 4: PUZZLE REKONSTRUKSI RUMUS ========
  const puzzleKoef = document.getElementById('puzzleKoef');
  const puzzleKonst = document.getElementById('puzzleKonst');
  const btnCekPuzzle = document.getElementById('btnCekPuzzle');
  const btnResetPuzzle = document.getElementById('btnResetPuzzle');
  const btnKeValidasi = document.getElementById('btnKeValidasi');
  const feedbackPuzzle = document.getElementById('feedbackPuzzle');
  const puzzleRows = document.querySelectorAll('tr[data-expected]');

  btnCekPuzzle?.addEventListener('click', () => {
    const k = parseInt(puzzleKoef?.value || '0');
    const c = parseInt(puzzleKonst?.value || '0');

    if (!k || !c) {
      feedbackPuzzle.textContent = 'âš ï¸ Lengkapi koefisien dan konstanta dulu!';
      feedbackPuzzle.className = 'feedback-box warning';
      return;
    }

    let allOk = true;
    puzzleRows.forEach(row => {
      const x = parseInt(row.dataset.x, 10);
      const expected = parseInt(row.dataset.expected, 10);
      const hasil = k * x + c;
      const hasilSpan = row.querySelector('.puzzleHasil');
      const statusSpan = row.querySelector('.puzzleStatus');

      hasilSpan.textContent = hasil.toLocaleString('id-ID');
      if (hasil === expected) {
        statusSpan.textContent = 'âœ”';
        statusSpan.style.color = 'var(--success)';
      } else {
        statusSpan.textContent = 'âœ–';
        statusSpan.style.color = 'var(--danger)';
        allOk = false;
      }
    });

    if (allOk) {
      discoveredFormula.coef = k;
      discoveredFormula.const = c;
      updateRumusDisplay();
      feedbackPuzzle.textContent = 'âœ… LUAR BIASA! Rumusmu berhasil melalui semua pengujian. Lanjut ke tabel validasi lengkap!';
      feedbackPuzzle.className = 'feedback-box success';
      
      if (btnKeValidasi) {
        btnKeValidasi.disabled = false;
        btnKeValidasi.style.opacity = '1';
        btnKeValidasi.style.cursor = 'pointer';
      }
    } else {
      feedbackPuzzle.textContent = 'âŒ Ada yang tidak cocok. Cek kembali koefisien dan konstanta Anda.';
      feedbackPuzzle.className = 'feedback-box error';
    }
  });

  btnResetPuzzle?.addEventListener('click', () => {
    puzzleKoef.value = '';
    puzzleKonst.value = '';
    puzzleRows.forEach(row => {
      row.querySelector('.puzzleHasil').textContent = 'â€”';
      row.querySelector('.puzzleStatus').textContent = '?';
      row.querySelector('.puzzleStatus').style.color = '';
    });
    feedbackPuzzle.className = 'feedback-box';
  });

  if (btnKeValidasi) {
    btnKeValidasi.addEventListener('click', () => show('validasi'));
  }

  // ======== UPDATE DISPLAY RUMUS ========
  function updateRumusDisplay() {
    if (discoveredFormula.coef && discoveredFormula.const) {
      document.getElementById('rumusMuDisplay').innerHTML = 
        `f(x) = <strong>${discoveredFormula.coef.toLocaleString('id-ID')}</strong> Ã— x + <strong>${discoveredFormula.const.toLocaleString('id-ID')}</strong>`;
      
      document.getElementById('rumusDisplay').textContent = 
        `f(x) = ${discoveredFormula.coef.toLocaleString('id-ID')}x + ${discoveredFormula.const.toLocaleString('id-ID')}`;

      document.getElementById('rumusKomponen').innerHTML = 
        `f(x) = <strong>${discoveredFormula.coef.toLocaleString('id-ID')}</strong>x + <strong>${discoveredFormula.const.toLocaleString('id-ID')}</strong>`;

      document.getElementById('nilaiKoef').textContent = discoveredFormula.coef.toLocaleString('id-ID');
      document.getElementById('nilaiKonst').textContent = discoveredFormula.const.toLocaleString('id-ID');

      // Update tabel validasi
      document.querySelectorAll('.rumusCell').forEach(cell => {
        const x = cell.closest('tr').dataset.x;
        const hasil = discoveredFormula.coef * x + discoveredFormula.const;
        cell.textContent = `${discoveredFormula.coef.toLocaleString('id-ID')}(${x}) + ${discoveredFormula.const.toLocaleString('id-ID')} = ${hasil.toLocaleString('id-ID')}`;
      });
    }
  }

  // ======== SLIDE 5: TABEL VALIDASI ========
  const inputs = document.querySelectorAll('.inputValidasi');
  const btnValidasiSemua = document.getElementById('btnValidasiSemua');
  const btnResetValidasi = document.getElementById('btnResetValidasi');
  const feedbackValidasi = document.getElementById('feedbackValidasi');

  function calculateF(x) {
    if (!discoveredFormula.coef || !discoveredFormula.const) return null;
    return discoveredFormula.coef * x + discoveredFormula.const;
  }

  inputs.forEach(input => {
    input.addEventListener('blur', () => {
      const x = parseFloat(input.dataset.x);
      const userVal = parseInt(input.value || '0');
      const correctVal = calculateF(x);
      const row = input.closest('tr');
      const statusIcon = row.querySelector('.statusIcon');

      if (userVal === correctVal) {
        statusIcon.textContent = 'âœ”';
        statusIcon.style.color = 'var(--success)';
      } else if (userVal === 0) {
        statusIcon.textContent = '?';
        statusIcon.style.color = 'var(--muted)';
      } else {
        statusIcon.textContent = 'âœ–';
        statusIcon.style.color = 'var(--danger)';
        input.style.borderColor = 'var(--danger)';
      }
    });
  });

  btnValidasiSemua?.addEventListener('click', () => {
    let correct = 0;
    let total = 0;

    inputs.forEach(input => {
      const x = parseFloat(input.dataset.x);
      const userVal = parseInt(input.value || '0');
      const correctVal = calculateF(x);

      if (userVal > 0) total++;
      if (userVal === correctVal) correct++;
    });

    if (total === 0) {
      feedbackValidasi.textContent = 'âš ï¸ Lengkapi semua input sebelum validasi!';
      feedbackValidasi.className = 'feedback-box warning';
      return;
    }

    if (correct === total) {
      feedbackValidasi.textContent = `âœ… SEMPURNA! ${correct}/${total} jawaban benar. Pemahaman Anda sudah solid!`;
      feedbackValidasi.className = 'feedback-box success';
    } else {
      feedbackValidasi.textContent = `âš ï¸ ${correct}/${total} benar. Periksa kembali perhitungannya.`;
      feedbackValidasi.className = 'feedback-box warning';
    }
  });

  btnResetValidasi?.addEventListener('click', () => {
    inputs.forEach(input => {
      input.value = '';
      input.style.borderColor = '#d1d5db';
      input.closest('tr').querySelector('.statusIcon').textContent = '-';
    });
    feedbackValidasi.className = 'feedback-box';
  });

  // ======== SLIDE: HITUNG 9 KM ========
  const distanceSlider = document.getElementById('distanceSlider');
  const distanceInput = document.getElementById('distanceInput');
  const btnHitung9km = document.getElementById('btnHitung9km');
  const feedbackHitung9km = document.getElementById('feedbackHitung9km');
  const breakdownList = document.getElementById('breakdownList');
  const arrowTableBody = document.querySelector('#arrowTable tbody');

  function getFormula() {
    const k = discoveredFormula?.coef || 4000;
    const c = discoveredFormula?.const || 5000;
    return { k, c };
  }

  function formatRp(n) {
    return n.toLocaleString('id-ID');
  }

  function renderArrowTable(d, k, c) {
    if (!arrowTableBody) return;
    arrowTableBody.innerHTML = '';
    for (let x = 1; x <= d; x++) {
      const val = k * x + c;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="text-align:center"><strong>${x}</strong></td>
        <td style="text-align:center">â†’</td>
        <td style="text-align:center"><strong>${formatRp(val)}</strong></td>
      `;
      arrowTableBody.appendChild(tr);
    }
  }

  function renderBreakdown(d, k, c) {
    if (!breakdownList) return;
    breakdownList.innerHTML = '';
    const total = k * d + c;
    const steps = [
      `Gunakan rumus: f(x) = kx + c`,
      `k (koefisien per km) = ${formatRp(k)}`,
      `c (konstanta) = ${formatRp(c)}`,
      `Perhitungan: ${formatRp(k)} Ã— ${d} + ${formatRp(c)} = ${formatRp(total)}`
    ];
    steps.forEach(s => {
      const li = document.createElement('li');
      li.textContent = s;
      breakdownList.appendChild(li);
    });
  }

  function computeAndShow() {
    const d = parseInt(distanceInput?.value || distanceSlider?.value || '9', 10);
    const { k, c } = getFormula();
    const total = k * d + c;

    renderBreakdown(d, k, c);
    renderArrowTable(d, k, c);

    if (!feedbackHitung9km) return;
    feedbackHitung9km.className = 'feedback-box success';
    if (d === 9) {
      feedbackHitung9km.textContent = `âœ… Untuk ${d} km: ${formatRp(k)}Ã—${d} + ${formatRp(c)} = ${formatRp(total)} (jawaban yang diharapkan)`;
    } else {
      feedbackHitung9km.textContent = `â„¹ï¸ Untuk ${d} km: ${formatRp(k)}Ã—${d} + ${formatRp(c)} = ${formatRp(total)}`;
    }
  }

  distanceSlider?.addEventListener('input', () => {
    if (distanceInput) distanceInput.value = distanceSlider.value;
    computeAndShow();
  });

  distanceInput?.addEventListener('change', () => {
    const val = Math.max(1, Math.min(20, parseInt(distanceInput.value || '9', 10)));
    distanceInput.value = String(val);
    if (distanceSlider) distanceSlider.value = String(val);
    computeAndShow();
  });

  btnHitung9km?.addEventListener('click', computeAndShow);

  // Auto-render if slide elements exist
  if (distanceInput && distanceSlider) {
    computeAndShow();
  }

  // ======== SLIDE 6: ANALISIS KOMPONEN ========
  // (Otomatis update saat updateRumusDisplay dipanggil)

  // ======== IDENTITAS KELOMPOK - SISTEM INPUT/PREVIEW ========
  
  // Deskripsi peran lengkap
  const deskripsiPeranMap = {
    'Ketua Kelompok': 'Memimpin diskusi, mengatur waktu, memastikan semua anggota ikut berkontribusi, dan membuat keputusan akhir.',
    'Wakil Ketua': 'Siap membantu ketua, menyiapkan materi, memotivasi anggota lain, dan menggantikan ketua jika diperlukan.',
    'Sekretaris': 'Mencatat hasil diskusi, menulis kesimpulan, mendokumentasikan proses, dan mengelola berkas kelompok.',
    'Anggota Aktif': 'Aktif memberikan ide, melakukan tugas teknis, mengerjakan soal, dan memberikan kontribusi nyata.',
    'Anggota': 'Turut serta dalam diskusi dan mengerjakan tugas kelompok sesuai arahan dari pemimpin.'
  };

  // Load data anggota dari localStorage saat page load
  function loadDataAnggota() {
    const saved = localStorage.getItem('daftarAnggotaTerdaftar');
    if (saved) {
      try {
        return JSON.parse(saved);
      } catch (e) {
        return [];
      }
    }
    return [];
  }

  // Save data anggota ke localStorage
  function saveDataAnggota(anggotaList) {
    localStorage.setItem('daftarAnggotaTerdaftar', JSON.stringify(anggotaList));
  }

  // Render preview anggota
  function renderPreviewAnggota() {
    const anggotaList = loadDataAnggota();
    const previewContainer = document.getElementById('previewAnggota');
    
    if (!previewContainer) return;

    if (anggotaList.length === 0) {
      previewContainer.innerHTML = `
        <div style="color:var(--muted);font-size:14px;text-align:center;padding:20px">
          ğŸ“ Belum ada anggota yang di-input. Isi form di bawah untuk mulai.
        </div>
      `;
      return;
    }

    previewContainer.innerHTML = anggotaList.map((anggota, idx) => `
      <div style="padding:14px;background:white;border-radius:8px;border-left:4px solid #8b5cf6;display:flex;justify-content:space-between;align-items:flex-start;gap:12px">
        <div style="flex:1">
          <div style="font-weight:700;color:var(--accent);font-size:15px;margin-bottom:6px">ğŸ‘¤ ${anggota.nama}</div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:4px"><b>ğŸ“‹ Peran:</b> ${anggota.peran}</div>
          <div style="font-size:13px;color:#059669;line-height:1.5"><b>âœ… Tugas:</b> ${deskripsiPeranMap[anggota.peran] || anggota.peran}</div>
        </div>
        <button class="btn ghost" onclick="hapusAnggotaTerdaftar(${idx})" style="min-width:50px;padding:8px;color:#ef4444">âœ–</button>
      </div>
    `).join('');
  }

  // Fungsi hapus anggota dari preview
  window.hapusAnggotaTerdaftar = function(idx) {
    const anggotaList = loadDataAnggota();
    anggotaList.splice(idx, 1);
    saveDataAnggota(anggotaList);
    renderPreviewAnggota();
  };

  // Event listener untuk input nama
  const inputNamaAnggota = document.getElementById('inputNamaAnggota');
  inputNamaAnggota?.addEventListener('focus', () => {
    // Clear preview description on focus to new input
  });

  // Event listener untuk select peran - tampilkan deskripsi
  const selectPenanggungJawab = document.getElementById('selectPenanggungJawab');
  selectPenanggungJawab?.addEventListener('change', () => {
    const peran = selectPenanggungJawab.value;
    const deskripsiDiv = document.getElementById('deskripsiPeran');
    const deskripsiTeks = document.getElementById('deskripsiTeks');
    
    if (peran && deskripsiPeranMap[peran]) {
      deskripsiDiv.style.display = 'block';
      deskripsiTeks.innerText = deskripsiPeranMap[peran];
    } else {
      deskripsiDiv.style.display = 'none';
    }
  });

  // Event listener untuk tombol INPUT
  const btnInputAnggota = document.getElementById('btnInputAnggota');
  btnInputAnggota?.addEventListener('click', () => {
    const nama = inputNamaAnggota?.value.trim() || '';
    const peran = selectPenanggungJawab?.value || '';

    if (!nama) {
      alert('âš ï¸ Mohon isi nama anggota terlebih dahulu.');
      return;
    }

    if (!peran) {
      alert('âš ï¸ Mohon pilih peran/tanggung jawab.');
      return;
    }

    // Cek duplikasi nama
    const anggotaList = loadDataAnggota();
    if (anggotaList.some(a => a.nama.toLowerCase() === nama.toLowerCase())) {
      alert('âš ï¸ Nama anggota sudah terdaftar. Gunakan nama lain.');
      return;
    }

    // Cek maksimal 5 anggota
    if (anggotaList.length >= 5) {
      alert('âš ï¸ Maksimal 5 anggota per kelompok.');
      return;
    }

    // Tambah anggota ke list
    anggotaList.push({ nama, peran });
    saveDataAnggota(anggotaList);

    // Reset form
    inputNamaAnggota.value = '';
    selectPenanggungJawab.value = '';
    document.getElementById('deskripsiPeran').style.display = 'none';
    inputNamaAnggota.focus();

    // Re-render preview
    renderPreviewAnggota();
  });

  // Render preview saat page load
  renderPreviewAnggota();

  // ======== VALIDASI SAAT LANJUT ========
  const btnLanjutPenyelidikan = document.getElementById('btnLanjutPenyelidikan');
  const feedbackKelompok = document.getElementById('feedbackKelompok');

  // Jika ada tombol lanjut, gunakan event listener lama
  btnLanjutPenyelidikan?.addEventListener('click', () => {
    const namaKelompok = document.getElementById('namaKelompok')?.value.trim();
    const anggota = loadDataAnggota();

    if (!namaKelompok) {
      alert('âš ï¸ Mohon isi nama kelompok terlebih dahulu.');
      return;
    }

    if (anggota.length === 0) {
      alert('âš ï¸ Mohon isi minimal 1 nama anggota.');
      return;
    }

    const kelompokData = { nama: namaKelompok, anggota: anggota };
    localStorage.setItem('kelompokData', JSON.stringify(kelompokData));

    // Simpan solusi awal jika ada
    const solusiAwal = document.getElementById('solusiAwalPertemuan4')?.value.trim();
    if (solusiAwal) {
      localStorage.setItem('solusiAwalPertemuan4', solusiAwal);
    }

    if (feedbackKelompok) {
      feedbackKelompok.textContent = `âœ… Kelompok "${namaKelompok}" tersimpan dengan ${anggota.length} anggota!`;
      feedbackKelompok.style.display = 'block';
      feedbackKelompok.style.background = '#d1fae5';
      feedbackKelompok.style.color = '#065f46';
      feedbackKelompok.style.borderLeft = '4px solid var(--success)';
    }

    setTimeout(() => show('skenario'), 800);
  });

  // ======== SLIDE LATIHAN: HITUNG JARAK LAINNYA ========
  const btnCekJawaban = document.getElementById('btnCekJawaban');
  const btnResetTabel = document.getElementById('btnResetTabel');
  const feedbackLatihan = document.getElementById('feedbackLatihan');

  // Data jawaban yang benar untuk setiap jarak (f(x) = 4000x + 5000)
  const jawabanBenar = {
    2: 13000,   // 4000 Ã— 2 + 5000 = 8000 + 5000 = 13000
    5: 25000,   // 4000 Ã— 5 + 5000 = 20000 + 5000 = 25000
    7: 33000,   // 4000 Ã— 7 + 5000 = 28000 + 5000 = 33000
    10: 45000,  // 4000 Ã— 10 + 5000 = 40000 + 5000 = 45000
    12: 53000,  // 4000 Ã— 12 + 5000 = 48000 + 5000 = 53000
    15: 65000,  // 4000 Ã— 15 + 5000 = 60000 + 5000 = 65000
    20: 85000   // 4000 Ã— 20 + 5000 = 80000 + 5000 = 85000
  };

  btnCekJawaban?.addEventListener('click', () => {
    let benar = 0;
    let salah = 0;
    let kosong = 0;

    Object.keys(jawabanBenar).forEach(jarak => {
      const inputTarif = document.getElementById(`tarif${jarak}`);
      const statusSpan = document.getElementById(`status${jarak}`);
      const jawaban = parseInt(inputTarif?.value || '0');

      if (!inputTarif?.value || jawaban === 0) {
        statusSpan.textContent = 'âš ï¸';
        statusSpan.style.color = 'var(--warning)';
        kosong++;
      } else if (jawaban === jawabanBenar[jarak]) {
        statusSpan.textContent = 'âœ…';
        statusSpan.style.color = 'var(--success)';
        benar++;
      } else {
        statusSpan.textContent = `âŒ (${formatRp(jawabanBenar[jarak])})`;
        statusSpan.style.color = 'var(--danger)';
        salah++;
      }
    });

    // Tampilkan feedback
    const total = Object.keys(jawabanBenar).length;
    if (kosong > 0) {
      feedbackLatihan.textContent = `âš ï¸ Masih ada ${kosong} jawaban yang belum diisi. Silakan lengkapi semua kolom!`;
      feedbackLatihan.className = 'feedback-box warning';
    } else if (benar === total) {
      feedbackLatihan.textContent = `ğŸ‰ Sempurna! Semua jawaban benar (${benar}/${total})! Kalian memahami rumus tarif dengan baik!`;
      feedbackLatihan.className = 'feedback-box success';
    } else if (benar >= total * 0.7) {
      feedbackLatihan.textContent = `ğŸ‘ Bagus! ${benar} dari ${total} jawaban benar. Periksa kembali yang salah dan coba lagi!`;
      feedbackLatihan.className = 'feedback-box success';
    } else {
      feedbackLatihan.textContent = `ğŸ“ ${benar} benar, ${salah} salah. Ingat rumusnya: f(x) = 4.000 Ã— x + 5.000. Coba lagi!`;
      feedbackLatihan.className = 'feedback-box warning';
    }
  });

  btnResetTabel?.addEventListener('click', () => {
    Object.keys(jawabanBenar).forEach(jarak => {
      const inputCalc = document.getElementById(`calc${jarak}`);
      const inputTarif = document.getElementById(`tarif${jarak}`);
      const statusSpan = document.getElementById(`status${jarak}`);

      if (inputCalc) inputCalc.value = '';
      if (inputTarif) inputTarif.value = '';
      if (statusSpan) {
        statusSpan.textContent = 'â€”';
        statusSpan.style.color = '';
      }
    });

    feedbackLatihan.textContent = '';
    feedbackLatihan.className = 'feedback-box';
  });

  // ======== SLIDE 8: EVALUASI & REFLEKSI ========
  const btnCekEvaluasi = document.getElementById('btnCekEvaluasi');
  const feedbackEvaluasi = document.getElementById('feedbackEvaluasi');
  const btnSimpanRefleksi = document.getElementById('btnSimpanRefleksi');
  const feedbackRefleksi = document.getElementById('feedbackRefleksi');
  const refleksiPembelajaran = document.getElementById('refleksiPembelajaran');
  const emojiLabel = document.getElementById('emojiLabel');
  const emojiBtns = document.querySelectorAll('.emoji-btn');

  let selectedRating = 0;
  const emojiLabels = {
    5: 'Sangat Senang! ğŸ˜Š',
    4: 'Senang ğŸ™‚',
    3: 'Biasa Saja ğŸ˜',
    2: 'Kurang Paham ğŸ˜•',
    1: 'Sulit Sekali ğŸ˜¢'
  };

  // Handle emoji selection
  emojiBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      // Reset all emojis
      emojiBtns.forEach(b => {
        b.style.border = '3px solid transparent';
        b.style.transform = 'scale(1)';
      });

      // Highlight selected emoji
      this.style.border = '3px solid var(--accent)';
      this.style.transform = 'scale(1.1)';
      
      selectedRating = parseInt(this.dataset.rating);
      emojiLabel.textContent = emojiLabels[selectedRating];
      emojiLabel.style.color = 'var(--accent)';
    });
  });

  // Cek jawaban evaluasi
  btnCekEvaluasi?.addEventListener('click', () => {
    const kunciJawaban = {
      soal1: 'C', // f(3) = 4000*3 + 5000 = 17000
      soal2: 'B', // 5000 adalah konstanta
      soal3: 'B', // {(1,2), (2,2), (3,4)} adalah fungsi
      soal4: 'C'  // Diagram lingkaran bukan penyajian fungsi
    };

    let benar = 0;
    let salah = 0;
    let kosong = 0;

    Object.keys(kunciJawaban).forEach(soal => {
      const selected = document.querySelector(`input[name="${soal}"]:checked`);
      if (!selected) {
        kosong++;
      } else if (selected.value === kunciJawaban[soal]) {
        benar++;
      } else {
        salah++;
      }
    });

    const total = Object.keys(kunciJawaban).length;
    const nilai = Math.round((benar / total) * 100);

    if (kosong > 0) {
      feedbackEvaluasi.textContent = `âš ï¸ Masih ada ${kosong} soal yang belum dijawab. Silakan lengkapi semua jawaban!`;
      feedbackEvaluasi.className = 'feedback-box warning';
    } else if (nilai >= 80) {
      feedbackEvaluasi.textContent = `ğŸ‰ Luar biasa! Nilai kamu: ${nilai} (${benar}/${total} benar). Kamu benar-benar memahami konsep fungsi!`;
      feedbackEvaluasi.className = 'feedback-box success';
    } else if (nilai >= 60) {
      feedbackEvaluasi.textContent = `ğŸ‘ Bagus! Nilai kamu: ${nilai} (${benar}/${total} benar). Terus tingkatkan pemahamanmu!`;
      feedbackEvaluasi.className = 'feedback-box success';
    } else {
      feedbackEvaluasi.textContent = `ğŸ“ Nilai kamu: ${nilai} (${benar}/${total} benar). Yuk, pelajari lagi materinya agar lebih paham!`;
      feedbackEvaluasi.className = 'feedback-box warning';
    }

    // Simpan hasil evaluasi
    localStorage.setItem('evaluasiNilai', nilai);
    localStorage.setItem('evaluasiBenar', benar);
    localStorage.setItem('evaluasiTotal', total);
  });

  // Simpan refleksi
  btnSimpanRefleksi?.addEventListener('click', () => {
    const refleksi = refleksiPembelajaran.value.trim();
    
    if (!selectedRating) {
      feedbackRefleksi.textContent = 'âš ï¸ Silakan pilih emoji yang menggambarkan perasaanmu terlebih dahulu!';
      feedbackRefleksi.className = 'feedback-box warning';
      return;
    }

    if (!refleksi || refleksi.length < 20) {
      feedbackRefleksi.textContent = 'âš ï¸ Refleksi terlalu pendek. Tuliskan minimal 20 karakter!';
      feedbackRefleksi.className = 'feedback-box warning';
      return;
    }

    // Simpan ke localStorage
    const refleksiData = {
      rating: selectedRating,
      emojiText: emojiLabels[selectedRating],
      refleksi: refleksi,
      timestamp: new Date().toISOString()
    };

    localStorage.setItem('refleksiPembelajaran', JSON.stringify(refleksiData));

    feedbackRefleksi.textContent = `âœ… Refleksi berhasil disimpan! Terima kasih atas partisipasi dan kejujuranmu dalam berbagi pengalaman belajar.`;
    feedbackRefleksi.className = 'feedback-box success';
  });

  // ======== DOWNLOAD LAPORAN PDF (jsPDF) ========
  const feedbackDownload = document.getElementById('feedbackDownload');

});

// Function to remove anggota row
function removeAnggota(btn) {
  const container = document.getElementById('anggotaContainer');
  if (container && container.querySelectorAll('.anggota-input').length <= 1) {
    alert('âš ï¸ Minimal ada 1 anggota kelompok.');
    return;
  }
  btn.parentElement.remove();
}

// PDF generation (jsPDF) - sesuai format pertemuan 6
window.generatePDFReport = async function(){
  const { jsPDF } = window.jspdf || {};
  if(!jsPDF){
    alert('Fitur PDF belum tersedia. Coba muat ulang halaman.');
    return;
  }

  if (feedbackDownload) {
    feedbackDownload.textContent = 'â³ Mempersiapkan laporan PDF...';
    feedbackDownload.className = 'feedback-box info';
  }

  const namaKelompok = document.getElementById('namaKelompok')?.value.trim() || 'Kelompok';
  const anggota = [];
  document.querySelectorAll('.anggota-input').forEach(input => {
    if (input.value.trim()) anggota.push(input.value.trim());
  });

  // Investigasi
  const observasi = document.getElementById('observasiData')?.value.trim() || '';
  const tarifPerKm = parseInt(document.getElementById('hipotesisTarifPerKm')?.value || '0');
  const prediksi4km = parseInt(document.getElementById('prediksi4km')?.value || '0');
  const biayaAwal = parseInt(document.getElementById('hipotesisBiayaAwal')?.value || '0');
  const rumusKoef = parseInt(document.getElementById('rumusKoef')?.value || '0');
  const rumusKonst = parseInt(document.getElementById('rumusKonst')?.value || '0');

  // Grafik kartesius
  let grafikData = null;
  try {
    const savedGrafik = localStorage.getItem('grafikKartesiusKelompok');
    if (savedGrafik) grafikData = JSON.parse(savedGrafik);
  } catch (e) {}

  if (!grafikData) {
    const canvas = document.getElementById('canvasKartesius');
    if (canvas) {
      grafikData = {
        image: canvas.toDataURL('image/png'),
        penjelasan: document.getElementById('penjelasanGrafik')?.value.trim() || '',
        titik: []
      };
    }
  }

  // Komentar gallery
  let daftarKomentarRumus = [];
  try {
    daftarKomentarRumus = JSON.parse(localStorage.getItem('komentarPeerReviewRumus') || '[]');
  } catch (e) {}

  // Evaluasi
  const kunciJawaban = { soal1: 'C', soal2: 'B', soal3: 'B', soal4: 'C' };
  const jawabanEvaluasi = {};
  let benarCount = 0;
  Object.keys(kunciJawaban).forEach(soal => {
    const selected = document.querySelector(`input[name="${soal}"]:checked`);
    jawabanEvaluasi[soal] = selected ? selected.value : '-';
    if (selected && selected.value === kunciJawaban[soal]) benarCount++;
  });
  const nilaiEvaluasi = Math.round((benarCount / 4) * 100);

  // Refleksi
  let refleksiData = null;
  try {
    const refleksiStr = localStorage.getItem('refleksiPembelajaran');
    refleksiData = refleksiStr ? JSON.parse(refleksiStr) : null;
  } catch (e) {}

  const refleksi7 = document.getElementById('refleksi7')?.value.trim() || '';
  const refleksi8 = document.getElementById('refleksi8')?.value.trim() || '';
  const refleksi9 = document.getElementById('refleksi9')?.value.trim() || '';

  const doc = new jsPDF('p', 'mm', 'a4');
  const margin = 20;
  const pageHeight = doc.internal.pageSize.height;
  const maxWidth = 170;
  let y = margin;

  const formatRupiah = (val) => (val && !isNaN(val) ? `Rp ${val.toLocaleString('id-ID')}` : '-');
  const formatNumber = (val) => (val && !isNaN(val) ? val.toString() : '-');

  function pageBreak(need = 20){
    if (y + need > pageHeight - margin){
      doc.addPage();
      y = margin;
    }
  }

  function addTitle(text, size = 14){
    pageBreak(size + 6);
    doc.setFontSize(size);
    doc.setFont(undefined, 'bold');
    doc.text(text, margin, y);
    y += size + 6;
  }

  function addText(text, size = 11){
    if (!text) return;
    doc.setFontSize(size);
    doc.setFont(undefined, 'normal');
    const lines = doc.splitTextToSize(text, maxWidth);
    pageBreak(lines.length * (size / 2) + 6);
    doc.text(lines, margin, y);
    y += lines.length * (size / 2) + 6;
  }

  function addImage(dataUrl, height = 80){
    if (!dataUrl || !dataUrl.startsWith('data:image')) return false;
    pageBreak(height + 10);
    doc.addImage(dataUrl, 'PNG', margin, y, maxWidth, height);
    y += height + 10;
    return true;
  }

  // Cover
  doc.setFontSize(22);
  doc.setFont(undefined, 'bold');
  doc.text('HASIL PEMBELAJARAN FUNGSI', doc.internal.pageSize.width / 2, 90, { align: 'center' });
  doc.setFontSize(13);
  doc.setFont(undefined, 'normal');
  doc.text('Masalah Ojek Online', doc.internal.pageSize.width / 2, 105, { align: 'center' });
  doc.text(new Date().toLocaleString('id-ID'), doc.internal.pageSize.width / 2, 118, { align: 'center' });
  doc.addPage();
  y = margin;

  // 1. Identitas
  addTitle('1. IDENTITAS KELOMPOK');
  addText(`Nama Kelompok: ${namaKelompok}`);
  addText(`Anggota: ${anggota.length > 0 ? anggota.join(', ') : '-'}`);

  // 2. Investigasi
  addTitle('2. INVESTIGASI / EKSPLORASI');
  addText(`Observasi awal: ${observasi || '-'}`);
  addText(`Hipotesis tarif per km: ${formatRupiah(tarifPerKm)}`);
  addText(`Prediksi tarif 4 km: ${formatRupiah(prediksi4km)}`);
  addText(`Biaya awal: ${formatRupiah(biayaAwal)}`);
  addText(`Rumus ditemukan: ${rumusKoef && rumusKonst ? `f(x) = ${rumusKoef}x + ${rumusKonst}` : '-'}`);

  // 3. Penyajian karya (diagram kartesius)
  addTitle('3. PENYAJIAN HASIL KARYA (DIAGRAM KARTESIUS)');
  if (grafikData && grafikData.image) {
    addImage(grafikData.image, 85);
  } else {
    addText('Grafik belum dibuat.');
  }
  addText(`Penjelasan grafik: ${grafikData?.penjelasan || '-'}`);
  if (grafikData?.titik && grafikData.titik.length > 0) {
    const titikText = grafikData.titik.map(t => `(${t.x}, ${t.y})`).join(', ');
    addText(`Titik yang digunakan: ${titikText}`);
  }

  // 4. Gallery Walk
  addTitle('4. GALLERY WALK (KOMENTAR)');
  if (daftarKomentarRumus.length > 0) {
    daftarKomentarRumus.forEach((k, i) => {
      addText(`${i + 1}. ${k.kelompok || 'Kelompok'}: ${k.komentar || '-'} ${k.waktu ? `(${k.waktu})` : ''}`);
    });
  } else {
    addText('Belum ada komentar.');
  }

  // 5. Evaluasi
  addTitle('5. EVALUASI MATERI');
  addText(`Nilai: ${nilaiEvaluasi}% (${benarCount}/4 benar)`);
  addText(`Soal 1: ${jawabanEvaluasi.soal1} (Kunci ${kunciJawaban.soal1})`);
  addText(`Soal 2: ${jawabanEvaluasi.soal2} (Kunci ${kunciJawaban.soal2})`);
  addText(`Soal 3: ${jawabanEvaluasi.soal3} (Kunci ${kunciJawaban.soal3})`);
  addText(`Soal 4: ${jawabanEvaluasi.soal4} (Kunci ${kunciJawaban.soal4})`);

  // 6. Refleksi
  addTitle('6. REFLEKSI');
  if (refleksiData) {
    addText(`Emoji: ${refleksiData.emojiText || '-'}`);
    addText(`Catatan refleksi: ${refleksiData.refleksi || '-'}`);
    if (refleksiData.timestamp) {
      addText(`Waktu pengisian: ${new Date(refleksiData.timestamp).toLocaleString('id-ID')}`);
    }
  } else {
    addText('Refleksi belum diisi.');
  }
  if (refleksi7) addText(`Refleksi mendalam 1: ${refleksi7}`);
  if (refleksi8) addText(`Refleksi mendalam 2: ${refleksi8}`);
  if (refleksi9) addText(`Refleksi mendalam 3: ${refleksi9}`);

  pageBreak(12);
  doc.setFontSize(9);
  doc.setFont(undefined, 'italic');
  doc.text(`Waktu unduh: ${new Date().toLocaleString('id-ID')}`, margin, y);

  const filename = `Hasil_Pertemuan4_${namaKelompok.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
  doc.save(filename);

  if (feedbackDownload) {
    feedbackDownload.textContent = 'âœ… PDF berhasil diunduh.';
    feedbackDownload.className = 'feedback-box success';
  }
};
</script>

<!-- Google Form Helper Script -->
<script src="google-form-helper.js"></script>

</body>
</html>
